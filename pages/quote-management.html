<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²¬ì ì„œ ê´€ë¦¬ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        /* ê¸°ì¡´ ëŒ€ì‹œë³´ë“œ UI ìŠ¤íƒ€ì¼ (ì›ë˜ ì½”ë“œ ê·¸ëŒ€ë¡œ) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background: #f3f4f6; padding: 20px; }
        .header { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 24px; color: #111827; }
        .header-actions { display: flex; gap: 12px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .content { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 24px; }
        .filter-section { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border: 2px solid #e5e7eb; background: white; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        .filter-btn.active { background: #667eea; color: white; border-color: #667eea; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f9fafb; font-weight: 600; color: #374151; }
        tr:hover { background: #f9fafb; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 700; }
        .status-draft { background: #e5e7eb; color: #6b7280; }
        .status-sent { background: #dbeafe; color: #1e40af; }
        .status-converted { background: #d1fae5; color: #065f46; }
        .btn-small { padding: 6px 12px; font-size: 12px; border: none; border-radius: 6px; cursor: pointer; margin-right: 4px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 12px; padding: 32px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h2 { font-size: 20px; font-weight: 700; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; }
        .items-section { margin: 24px 0; border: 2px solid #e5e7eb; border-radius: 8px; padding: 16px; }
        .item-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 8px; margin-bottom: 8px; align-items: center; }
        .item-row input { padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; }
        .remove-item { background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        .total-section { background: #f9fafb; padding: 16px; border-radius: 8px; margin-top: 16px; }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .total-row.grand-total { font-size: 18px; font-weight: 700; color: #667eea; border-top: 2px solid #e5e7eb; padding-top: 8px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“„ ê²¬ì ì„œ ê´€ë¦¬</h1>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openQuoteModal()">+ ê²¬ì ì„œ ì‘ì„±</button>
            <button class="btn btn-primary" onclick="history.back()">â† ë’¤ë¡œ</button>
            <button class="btn btn-secondary" onclick="window.location.href='../dashboard-tabs.html'">ğŸ  ëŒ€ì‹œë³´ë“œ</button>
        </div>
    </div>

    <div class="content">
        <div class="filter-section">
            <button class="filter-btn active" onclick="filterQuotes('all')">ì „ì²´</button>
            <button class="filter-btn" onclick="filterQuotes('draft')">ì„ì‹œì €ì¥</button>
            <button class="filter-btn" onclick="filterQuotes('sent')">ë°œì†¡ì™„ë£Œ</button>
            <button class="filter-btn" onclick="filterQuotes('converted')">ì˜ë¢°ì „í™˜</button>
        </div>

        <table id="quoteTable">
            <thead>
                <tr>
                    <th>ê²¬ì ë²ˆí˜¸</th>
                    <th>ìˆ˜ì‹ ì²˜</th>
                    <th>ì‘ì„±ì¼</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ìƒíƒœ</th>
                    <th>ì‘ì—…</th>
                </tr>
            </thead>
            <tbody id="quoteTableBody">
                </tbody>
        </table>
    </div>

    <div id="quoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ê²¬ì ì„œ ì‘ì„±</h2>
                <button class="close-btn" onclick="closeQuoteModal()">Ã—</button>
            </div>

            <form id="quoteForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ê²¬ì ë²ˆí˜¸ (ìë™ìƒì„±)</label>
                        <input type="text" id="quoteNumber" readonly>
                    </div>
                    <div class="form-group">
                        <label>ì‘ì„±ì¼</label>
                        <input type="date" id="quoteDate" required>
                    </div>
                </div>

                <h3 style="margin: 24px 0 16px 0; font-size: 16px;">ìˆ˜ì‹ ì²˜ ì •ë³´</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ìˆ˜ì‹ ì²˜ëª… *</label>
                        <input type="text" id="clientName" placeholder="(ì£¼)ë„ì„œì¶œíŒë³´ë¦¬" required>
                    </div>
                    <div class="form-group">
                        <label>ë‹´ë‹¹ì</label>
                        <input type="text" id="clientContact" placeholder="í™ê¸¸ë™">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì „í™”ë²ˆí˜¸</label>
                        <input type="text" id="clientPhone" placeholder="031-950-9511">
                    </div>
                    <div class="form-group">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="clientEmail" placeholder="client@example.com">
                    </div>
                </div>

                <h3 style="margin: 24px 0 16px 0; font-size: 16px;">ê²¬ì  ë‚´ì—­</h3>
                <div class="items-section">
                    <div id="itemsContainer">
                        <div class="item-row">
                            <input type="text" placeholder="í’ˆëª… (ì˜ˆ: ìˆ˜ì§ˆê²€ì‚¬ ìƒí™œìš©ìˆ˜20í•­ëª©)" class="item-name" required>
                            <input type="number" placeholder="ë‹¨ê°€" class="item-price" min="0" onchange="calculateTotal()" required>
                            <input type="number" placeholder="ìˆ˜ëŸ‰" class="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
                            <input type="number" placeholder="ê¸ˆì•¡" class="item-amount" readonly>
                            <button type="button" class="remove-item" onclick="removeItem(this)" style="display: none;">ì‚­ì œ</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-success" onclick="addItem()" style="margin-top: 8px;">+ í•­ëª© ì¶”ê°€</button>
                </div>

                <div class="total-section">
                    <div class="total-row">
                        <span>ê¸ˆì•¡:</span>
                        <span id="subtotal">0ì›</span>
                    </div>
                    <div class="total-row">
                        <span>ë¶€ê°€ì„¸ (10%):</span>
                        <span id="vat">0ì›</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>í•©ê³„:</span>
                        <span id="grandTotal">0ì›</span>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 16px;">
                    <label>ë¹„ê³ </label>
                    <textarea id="notes" rows="3" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥"></textarea>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" onclick="saveQuote('draft')" style="flex: 1;">ì„ì‹œì €ì¥</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ì €ì¥ & PDF ìƒì„±</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let quotes = [];
        let currentFilter = 'all';
        let editMode = false;
        let editId = null;

        function init() {
            quotes = JSON.parse(localStorage.getItem('dasol_quotes') || '[]');
            renderQuoteTable();
            
            document.getElementById('quoteDate').value = new Date().toISOString().split('T')[0];
            generateQuoteNumber();

            document.getElementById('quoteForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveQuote('sent');
            });
        }

        function generateQuoteNumber() {
            const today = new Date();
            const year = today.getFullYear().toString().slice(2);
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const existingQuotes = quotes.filter(q => q.quoteNumber && q.quoteNumber.startsWith(`ê²¬ì ${year}${month}`));
            const sequence = String(existingQuotes.length + 1).padStart(4, '0');
            document.getElementById('quoteNumber').value = `ê²¬ì ${year}${month}-${sequence}`;
        }

        function openQuoteModal() {
            editMode = false;
            editId = null;
            document.getElementById('quoteModal').classList.add('show');
            document.getElementById('quoteForm').reset();
            generateQuoteNumber();
            document.getElementById('quoteDate').value = new Date().toISOString().split('T')[0];
            
            const itemsContainer = document.getElementById('itemsContainer');
            itemsContainer.innerHTML = `
                <div class="item-row">
                    <input type="text" placeholder="í’ˆëª… (ì˜ˆ: ìˆ˜ì§ˆê²€ì‚¬ ìƒí™œìš©ìˆ˜20í•­ëª©)" class="item-name" required>
                    <input type="number" placeholder="ë‹¨ê°€" class="item-price" min="0" onchange="calculateTotal()" required>
                    <input type="number" placeholder="ìˆ˜ëŸ‰" class="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
                    <input type="number" placeholder="ê¸ˆì•¡" class="item-amount" readonly>
                    <button type="button" class="remove-item" onclick="removeItem(this)" style="display: none;">ì‚­ì œ</button>
                </div>
            `;
            calculateTotal();
        }

        function closeQuoteModal() {
            document.getElementById('quoteModal').classList.remove('show');
        }

        function addItem() {
            const container = document.getElementById('itemsContainer');
            const newRow = document.createElement('div');
            newRow.className = 'item-row';
            newRow.innerHTML = `
                <input type="text" placeholder="í’ˆëª…" class="item-name" required>
                <input type="number" placeholder="ë‹¨ê°€" class="item-price" min="0" onchange="calculateTotal()" required>
                <input type="number" placeholder="ìˆ˜ëŸ‰" class="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
                <input type="number" placeholder="ê¸ˆì•¡" class="item-amount" readonly>
                <button type="button" class="remove-item" onclick="removeItem(this)">ì‚­ì œ</button>
            `;
            container.appendChild(newRow);
            updateRemoveButtons();
        }

        function removeItem(btn) {
            btn.closest('.item-row').remove();
            calculateTotal();
            updateRemoveButtons();
        }

        function updateRemoveButtons() {
            const rows = document.querySelectorAll('.item-row');
            rows.forEach((row, index) => {
                const removeBtn = row.querySelector('.remove-item');
                if (rows.length === 1) {
                    removeBtn.style.display = 'none';
                } else {
