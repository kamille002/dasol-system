<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²¬ì ì„œ ê´€ë¦¬ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        /* ê¸°ì¡´ ëŒ€ì‹œë³´ë“œ UI ìŠ¤íƒ€ì¼ (ì›ë˜ ì½”ë“œ ê·¸ëŒ€ë¡œ) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background: #f3f4f6; padding: 20px; }
        .header { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 24px; color: #111827; }
        .header-actions { display: flex; gap: 12px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .content { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 24px; }
        .filter-section { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border: 2px solid #e5e7eb; background: white; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        .filter-btn.active { background: #667eea; color: white; border-color: #667eea; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f9fafb; font-weight: 600; color: #374151; }
        tr:hover { background: #f9fafb; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 700; }
        .status-draft { background: #e5e7eb; color: #6b7280; }
        .status-sent { background: #dbeafe; color: #1e40af; }
        .status-converted { background: #d1fae5; color: #065f46; }
        .btn-small { padding: 6px 12px; font-size: 12px; border: none; border-radius: 6px; cursor: pointer; margin-right: 4px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 12px; padding: 32px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h2 { font-size: 20px; font-weight: 700; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; }
        .items-section { margin: 24px 0; border: 2px solid #e5e7eb; border-radius: 8px; padding: 16px; }
        .item-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 8px; margin-bottom: 8px; align-items: center; }
        .item-row input { padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; }
        .remove-item { background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        .total-section { background: #f9fafb; padding: 16px; border-radius: 8px; margin-top: 16px; }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .total-row.grand-total { font-size: 18px; font-weight: 700; color: #667eea; border-top: 2px solid #e5e7eb; padding-top: 8px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“„ ê²¬ì ì„œ ê´€ë¦¬</h1>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openQuoteModal()">+ ê²¬ì ì„œ ì‘ì„±</button>
            <button class="btn btn-primary" onclick="history.back()">â† ë’¤ë¡œ</button>
            <button class="btn btn-secondary" onclick="window.location.href='../dashboard-tabs.html'">ğŸ  ëŒ€ì‹œë³´ë“œ</button>
        </div>
    </div>

    <div class="content">
        <div class="filter-section">
            <button class="filter-btn active" onclick="filterQuotes('all')">ì „ì²´</button>
            <button class="filter-btn" onclick="filterQuotes('draft')">ì„ì‹œì €ì¥</button>
            <button class="filter-btn" onclick="filterQuotes('sent')">ë°œì†¡ì™„ë£Œ</button>
            <button class="filter-btn" onclick="filterQuotes('converted')">ì˜ë¢°ì „í™˜</button>
        </div>

        <table id="quoteTable">
            <thead>
                <tr>
                    <th>ê²¬ì ë²ˆí˜¸</th>
                    <th>ìˆ˜ì‹ ì²˜</th>
                    <th>ì‘ì„±ì¼</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ìƒíƒœ</th>
                    <th>ì‘ì—…</th>
                </tr>
            </thead>
            <tbody id="quoteTableBody">
                </tbody>
        </table>
    </div>

    <div id="quoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ê²¬ì ì„œ ì‘ì„±</h2>
                <button class="close-btn" onclick="closeQuoteModal()">Ã—</button>
            </div>

            <form id="quoteForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ê²¬ì ë²ˆí˜¸ (ìë™ìƒì„±)</label>
                        <input type="text" id="quoteNumber" readonly>
                    </div>
                    <div class="form-group">
                        <label>ì‘ì„±ì¼</label>
                        <input type="date" id="quoteDate" required>
                    </div>
                </div>

                <h3 style="margin: 24px 0 16px 0; font-size: 16px;">ìˆ˜ì‹ ì²˜ ì •ë³´</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ìˆ˜ì‹ ì²˜ëª… *</label>
                        <input type="text" id="clientName" placeholder="(ì£¼)ë„ì„œì¶œíŒë³´ë¦¬" required>
                    </div>
                    <div class="form-group">
                        <label>ë‹´ë‹¹ì</label>
                        <input type="text" id="clientContact" placeholder="í™ê¸¸ë™">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì „í™”ë²ˆí˜¸</label>
                        <input type="text" id="clientPhone" placeholder="031-950-9511">
                    </div>
                    <div class="form-group">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="clientEmail" placeholder="client@example.com">
                    </div>
                </div>

                <h3 style="margin: 24px 0 16px 0; font-size: 16px;">ê²¬ì  ë‚´ì—­</h3>
                <div class="items-section">
                    <div id="itemsContainer">
                        <div class="item-row">
                            <input type="text" placeholder="í’ˆëª… (ì˜ˆ: ìˆ˜ì§ˆê²€ì‚¬ ìƒí™œìš©ìˆ˜20í•­ëª©)" class="item-name" required>
                            <input type="number" placeholder="ë‹¨ê°€" class="item-price" min="0" onchange="calculateTotal()" required>
                            <input type="number" placeholder="ìˆ˜ëŸ‰" class="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
                            <input type="number" placeholder="ê¸ˆì•¡" class="item-amount" readonly>
                            <button type="button" class="remove-item" onclick="removeItem(this)" style="display: none;">ì‚­ì œ</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-success" onclick="addItem()" style="margin-top: 8px;">+ í•­ëª© ì¶”ê°€</button>
                </div>

                <div class="total-section">
                    <div class="total-row">
                        <span>ê¸ˆì•¡:</span>
                        <span id="subtotal">0ì›</span>
                    </div>
                    <div class="total-row">
                        <span>ë¶€ê°€ì„¸ (10%):</span>
                        <span id="vat">0ì›</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>í•©ê³„:</span>
                        <span id="grandTotal">0ì›</span>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 16px;">
                    <label>ë¹„ê³ </label>
                    <textarea id="notes" rows="3" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥"></textarea>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="button" class="btn btn-secondary" onclick="saveQuote('draft')" style="flex: 1;">ì„ì‹œì €ì¥</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">ì €ì¥ & PDF ìƒì„±</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let quotes = [];
        let currentFilter = 'all';
        let editMode = false;
        let editId = null;

        function init() {
            quotes = JSON.parse(localStorage.getItem('dasol_quotes') || '[]');
            renderQuoteTable();
            
            document.getElementById('quoteDate').value = new Date().toISOString().split('T')[0];
            generateQuoteNumber();

            document.getElementById('quoteForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveQuote('sent');
            });
        }

        function generateQuoteNumber() {
            const today = new Date();
            const year = today.getFullYear().toString().slice(2);
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const existingQuotes = quotes.filter(q => q.quoteNumber && q.quoteNumber.startsWith(`ê²¬ì ${year}${month}`));
            const sequence = String(existingQuotes.length + 1).padStart(4, '0');
            document.getElementById('quoteNumber').value = `ê²¬ì ${year}${month}-${sequence}`;
        }

        function openQuoteModal() {
            editMode = false;
            editId = null;
            document.getElementById('quoteModal').classList.add('show');
            document.getElementById('quoteForm').reset();
            generateQuoteNumber();
            document.getElementById('quoteDate').value = new Date().toISOString().split('T')[0];
            
            const itemsContainer = document.getElementById('itemsContainer');
            itemsContainer.innerHTML = `
                <div class="item-row">
                    <input type="text" placeholder="í’ˆëª… (ì˜ˆ: ìˆ˜ì§ˆê²€ì‚¬ ìƒí™œìš©ìˆ˜20í•­ëª©)" class="item-name" required>
                    <input type="number" placeholder="ë‹¨ê°€" class="item-price" min="0" onchange="calculateTotal()" required>
                    <input type="number" placeholder="ìˆ˜ëŸ‰" class="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
                    <input type="number" placeholder="ê¸ˆì•¡" class="item-amount" readonly>
                    <button type="button" class="remove-item" onclick="removeItem(this)" style="display: none;">ì‚­ì œ</button>
                </div>
            `;
            calculateTotal();
        }

        function closeQuoteModal() {
            document.getElementById('quoteModal').classList.remove('show');
        }

        function addItem() {
            const container = document.getElementById('itemsContainer');
            const newRow = document.createElement('div');
            newRow.className = 'item-row';
            newRow.innerHTML = `
                <input type="text" placeholder="í’ˆëª…" class="item-name" required>
                <input type="number" placeholder="ë‹¨ê°€" class="item-price" min="0" onchange="calculateTotal()" required>
                <input type="number" placeholder="ìˆ˜ëŸ‰" class="item-quantity" min="1" value="1" onchange="calculateTotal()" required>
                <input type="number" placeholder="ê¸ˆì•¡" class="item-amount" readonly>
                <button type="button" class="remove-item" onclick="removeItem(this)">ì‚­ì œ</button>
            `;
            container.appendChild(newRow);
            updateRemoveButtons();
        }

        function removeItem(btn) {
            btn.closest('.item-row').remove();
            calculateTotal();
            updateRemoveButtons();
        }

        function updateRemoveButtons() {
            const rows = document.querySelectorAll('.item-row');
            rows.forEach((row, index) => {
                const removeBtn = row.querySelector('.remove-item');
                if (rows.length === 1) {
                    removeBtn.style.display = 'none';
                } else {
                    removeBtn.style.display = 'block';
                }
            });
        }

        function calculateTotal() {
            const rows = document.querySelectorAll('.item-row');
            let subtotal = 0;

            rows.forEach(row => {
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const amount = price * quantity;
                row.querySelector('.item-amount').value = amount;
                subtotal += amount;
            });

            const vat = Math.round(subtotal * 0.1);
            const grandTotal = subtotal + vat;

            document.getElementById('subtotal').textContent = subtotal.toLocaleString() + 'ì›';
            document.getElementById('vat').textContent = vat.toLocaleString() + 'ì›';
            document.getElementById('grandTotal').textContent = grandTotal.toLocaleString() + 'ì›';
        }

        function saveQuote(status) {
            const rows = document.querySelectorAll('.item-row');
            const items = [];
            let subtotal = 0;

            rows.forEach(row => {
                const name = row.querySelector('.item-name').value;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const amount = price * quantity;
                
                items.push({ name, price, quantity, amount });
                subtotal += amount;
            });

            const vat = Math.round(subtotal * 0.1);
            const grandTotal = subtotal + vat;

            const quote = {
                id: editMode ? editId : 'Q' + Date.now(),
                quoteNumber: document.getElementById('quoteNumber').value,
                quoteDate: document.getElementById('quoteDate').value,
                clientName: document.getElementById('clientName').value,
                clientContact: document.getElementById('clientContact').value,
                clientPhone: document.getElementById('clientPhone').value,
                clientEmail: document.getElementById('clientEmail').value,
                items: items,
                subtotal: subtotal,
                vat: vat,
                grandTotal: grandTotal,
                notes: document.getElementById('notes').value,
                status: status,
                createdAt: editMode ? quotes.find(q => q.id === editId).createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                createdBy: JSON.parse(localStorage.getItem('dasol_session') || '{}').name || 'ê´€ë¦¬ì'
            };

            if (editMode) {
                quotes = quotes.map(q => q.id === editId ? quote : q);
            } else {
                quotes.push(quote);
            }

            localStorage.setItem('dasol_quotes', JSON.stringify(quotes));
            
            if (status === 'sent') {
                generateQuotePDF(quote);
            }
            
            closeQuoteModal();
            renderQuoteTable();
            alert(status === 'draft' ? 'ì„ì‹œì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ê²¬ì ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function renderQuoteTable() {
            const tbody = document.getElementById('quoteTableBody');
            
            let filtered = quotes;
            if (currentFilter !== 'all') {
                filtered = quotes.filter(q => q.status === currentFilter);
            }

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">ë“±ë¡ëœ ê²¬ì ì„œê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
                return;
            }

            tbody.innerHTML = filtered.map(quote => `
                <tr>
                    <td>${quote.quoteNumber}</td>
                    <td>${quote.clientName}</td>
                    <td>${formatDate(quote.quoteDate)}</td>
                    <td style="font-weight: 700; color: #667eea;">${quote.grandTotal.toLocaleString()}ì›</td>
                    <td><span class="status-badge status-${quote.status}">${quote.status === 'draft' ? 'ì„ì‹œì €ì¥' : quote.status === 'sent' ? 'ë°œì†¡ì™„ë£Œ' : 'ì˜ë¢°ì „í™˜'}</span></td>
                    <td>
                        <button class="btn-small" style="background: #667eea; color: white;" onclick="viewQuotePDF('${quote.id}')">PDF</button>
                        <button class="btn-small" style="background: #10b981; color: white;" onclick="convertToRequest('${quote.id}')">ì˜ë¢°ì „í™˜</button>
                        <button class="btn-small" style="background: #ef4444; color: white;" onclick="deleteQuote('${quote.id}')">ì‚­ì œ</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterQuotes(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderQuoteTable();
        }

        function deleteQuote(id) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            quotes = quotes.filter(q => q.id !== id);
            localStorage.setItem('dasol_quotes', JSON.stringify(quotes));
            renderQuoteTable();
        }

        function convertToRequest(id) {
            if (!confirm('ì´ ê²¬ì ì„œë¥¼ ì˜ë¢°ì„œë¡œ ì „í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const quote = quotes.find(q => q.id === id);
            quote.status = 'converted';
            localStorage.setItem('dasol_quotes', JSON.stringify(quotes));
            sessionStorage.setItem('convertedQuote', JSON.stringify(quote));
            window.location.href = 'request-register.html?fromQuote=true';
        }

        function viewQuotePDF(id) {
            const quote = quotes.find(q => q.id === id);
            generateQuotePDF(quote);
        }

        // â–¼ ì—¬ê¸°ê°€ ì œê°€ ìƒˆë¡œ ì§  ë¯¸ë‹ˆë©€ í•˜ì´ì—”ë“œ ë””ìì¸ì…ë‹ˆë‹¤! â–¼
        function generateQuotePDF(quote) {
            const html = `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>ê²¬ì ì„œ - ${quote.quoteNumber}</title>
                    <style>
                        @page { size: A4; margin: 20mm; }
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body {
                            font-family: 'Pretendard', 'Malgun Gothic', 'Noto Sans KR', sans-serif;
                            padding: 40px;
                            color: #111827;
                            line-height: 1.6;
                        }
                        
                        .header-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 50px; border-bottom: 2px solid #111827; padding-bottom: 20px; }
                        .title { font-size: 38px; font-weight: 800; letter-spacing: 15px; margin-left: 15px; }
                        .meta-info { text-align: right; font-size: 13px; color: #4b5563; }
                        .meta-info div { margin-bottom: 4px; }
                        .meta-info strong { color: #111827; display: inline-block; width: 60px; text-align: left; }

                        .info-section { display: flex; justify-content: space-between; gap: 60px; margin-bottom: 50px; }
                        .info-box { flex: 1; }
                        .info-box h3 { font-size: 13px; color: #6b7280; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 20px; font-weight: 600; }
                        .info-row { display: flex; margin-bottom: 10px; font-size: 14px; align-items: center; }
                        .info-label { width: 80px; color: #6b7280; font-size: 13px; }
                        .info-value { flex: 1; font-weight: 500; }
                        .amount-highlight { font-size: 16px; font-weight: 700; color: #111827; margin-top: 10px; }

                        /* ë§ˆë²•ì˜ ë„ì¥ ì…‹íŒ… */
                        .ceo-name-wrap { position: relative; display: inline-block; }
                        .stamp-image {
                            position: absolute;
                            top: 50%;
                            left: 100%;
                            transform: translate(-30%, -50%);
                            width: 55px;
                            height: 55px;
                            mix-blend-mode: multiply;
                            opacity: 0.9;
                            z-index: -1;
                        }

                        .statement { text-align: left; font-size: 15px; font-weight: 700; margin-bottom: 15px; color: #111827; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; border-top: 2px solid #111827; border-bottom: 2px solid #111827; }
                        th, td { padding: 16px 12px; border-bottom: 1px solid #e5e7eb; font-size: 14px; }
                        th { background: #f9fafb; color: #4b5563; font-weight: 600; font-size: 13px; text-align: center; }
                        td { text-align: center; }
                        td.align-left { text-align: left; padding-left: 20px; }
                        td.align-right { text-align: right; font-weight: 500; }

                        .total-section { width: 350px; margin-left: auto; border-top: 1px solid #111827; padding-top: 20px; }
                        .total-row { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 12px; color: #4b5563; }
                        .total-row.grand { font-size: 20px; font-weight: 800; color: #111827; border-top: 2px solid #111827; padding-top: 15px; margin-top: 5px; }

                        .notes-area { margin-top: 40px; padding: 20px; background: #f9fafb; border-radius: 8px; font-size: 13px; color: #4b5563; }
                        .footer { margin-top: 80px; padding-top: 30px; display: flex; align-items: center; justify-content: center; gap: 24px; }
                        .footer-logo { width: 120px; object-fit: contain; }
                        .footer-details { font-size: 13px; color: #6b7280; line-height: 1.8; border-left: 1px solid #e5e7eb; padding-left: 24px; }
                        .footer-details strong { color: #111827; font-size: 15px; display: block; margin-bottom: 4px; }

                        @media print {
                            .no-print { display: none; }
                            body { padding: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header-top">
                        <div class="title">ê²¬ ì  ì„œ</div>
                        <div class="meta-info">
                            <div><strong>ë¬¸ì„œë²ˆí˜¸</strong> ${quote.quoteNumber}</div>
                            <div><strong>ê²¬ì ì¼ì</strong> ${new Date(quote.createdAt).toLocaleDateString('ko-KR')}</div>
                            <div><strong>ìœ íš¨ê¸°ê°„</strong> ê²¬ì ì¼ë¡œë¶€í„° 30ì¼</div>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-box">
                            <h3>ìˆ˜ ì‹  (To)</h3>
                            <div class="info-row"><div class="info-label">ìƒ í˜¸</div><div class="info-value">${quote.clientName} ê·€ì¤‘</div></div>
                            <div class="info-row"><div class="info-label">ë‹´ë‹¹ì</div><div class="info-value">${quote.clientContact || '-'}</div></div>
                            <div class="info-row"><div class="info-label">ì—°ë½ì²˜</div><div class="info-value">${quote.clientPhone || '-'}</div></div>
                            <div class="amount-highlight">
                                í•©ê³„ê¸ˆì•¡: â‚© ${quote.grandTotal.toLocaleString()} <br>
                                <span style="font-size: 13px; color: #6b7280; font-weight: 500;">(ì¼ê¸ˆ ${convertNumberToKorean(quote.grandTotal)}ì›ì •)</span>
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <h3>ë°œ ì‹  (From)</h3>
                            <div class="info-row"><div class="info-label">ìƒ í˜¸</div><div class="info-value">(ì£¼)ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</div></div>
                            <div class="info-row">
                                <div class="info-label">ëŒ€í‘œì´ì‚¬</div>
                                <div class="info-value">
                                    <div class="ceo-name-wrap">
                                        ì‹¬íƒœë³´
                                        <img src="../assets/ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ 4ê°ë„ì¥.png" class="stamp-image" alt="ì§ì¸">
                                    </div>
                                </div>
                            </div>
                            <div class="info-row"><div class="info-label">ë“±ë¡ë²ˆí˜¸</div><div class="info-value">214-88-95667</div></div>
                            <div class="info-row"><div class="info-label">ì£¼ ì†Œ</div><div class="info-value" style="font-size: 13px;">ê²½ê¸°ë„ í•˜ë‚¨ì‹œ ì´ˆê´‘ì‚°ë‹¨ë¡œ 126, ìš°ì¼ë¹Œë”© 3ì¸µ</div></div>
                            <div class="info-row"><div class="info-label">ê²°ì œê³„ì¢Œ</div><div class="info-value">êµ­ë¯¼ì€í–‰ 220401-04-219973</div></div>
                        </div>
                    </div>
                    
                    <div class="statement">ì•„ë˜ì™€ ê°™ì´ ê²¬ì í•©ë‹ˆë‹¤.</div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th width="8%">No.</th>
                                <th width="15%">êµ¬ë¶„</th>
                                <th>í’ˆëª…</th>
                                <th width="15%">ë‹¨ê°€(ì›)</th>
                                <th width="10%">ìˆ˜ëŸ‰</th>
                                <th width="18%">ê¸ˆì•¡(ì›)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${quote.items.map((item, index) => `
                                <tr>
                                    <td>${(index + 1).toString().padStart(2, '0')}</td>
                                    <td>ìˆ˜ì§ˆê²€ì‚¬</td>
                                    <td class="align-left" style="font-weight: 600;">${item.name}</td>
                                    <td class="align-right">${item.price.toLocaleString()}</td>
                                    <td>${item.quantity}</td>
                                    <td class="align-right" style="font-weight: 700;">${item.amount.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="total-section">
                        <div class="total-row"><span>ê³µê¸‰ê°€ì•¡</span><span>${quote.subtotal.toLocaleString()} ì›</span></div>
                        <div class="total-row"><span>ë¶€ê°€ì„¸ (VAT)</span><span>${quote.vat.toLocaleString()} ì›</span></div>
                        <div class="total-row grand"><span>ì´ ì²­êµ¬ê¸ˆì•¡</span><span>${quote.grandTotal.toLocaleString()} ì›</span></div>
                    </div>
                    
                    ${quote.notes ? `<div class="notes-area"><strong style="color: #111827; display: block; margin-bottom: 8px;">â€» íŠ¹ì´ì‚¬í•­ ë° ë¹„ê³ </strong>${quote.notes.replace(/\\n/g, '<br>')}</div>` : ''}
                    
                    <div class="footer">
                        <img src="../assets/ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ ë¡œê³ .png" alt="ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ ë¡œê³ " class="footer-logo" />
                        <div class="footer-details">
                            <strong>ì£¼ì‹íšŒì‚¬ ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</strong>
                            Tel. 031-772-4530 &nbsp;|&nbsp; Fax. 070-8677-0553<br>
                            E-mail. dasolwater@example.com
                        </div>
                    </div>
                    
                    <div class="no-print" style="margin-top: 50px; text-align: center; padding: 20px; background: #f3f4f6; border-radius: 8px;">
                        <button onclick="window.print()" style="padding: 12px 32px; background: #111827; color: white; border: none; border-radius: 6px; font-size: 15px; cursor: pointer; margin-right: 12px; font-weight: 600; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">ì¸ì‡„ ë° PDF ì €ì¥</button>
                        <button onclick="window.close()" style="padding: 12px 32px; background: white; color: #4b5563; border: 1px solid #d1d5db; border-radius: 6px; font-size: 15px; cursor: pointer; font-weight: 600;">ì°½ ë‹«ê¸°</button>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank', 'width=900,height=950');
            printWindow.document.write(html);
            printWindow.document.close();
        }

        function convertNumberToKorean(num) {
            const units = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
            const nums = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];
            const positions = ['', 'ì‹­', 'ë°±', 'ì²œ'];
            if (num === 0) return 'ì˜';
            let result = '';
            let unitIndex = 0;
            while (num > 0) {
                const part = num % 10000;
                if (part > 0) {
                    let partStr = '';
                    let tempPart = part;
                    let posIndex = 0;
                    while (tempPart > 0) {
                        const digit = tempPart % 10;
                        if (digit > 0) {
                            partStr = nums[digit] + positions[posIndex] + partStr;
                        }
                        tempPart = Math.floor(tempPart / 10);
                        posIndex++;
                    }
                    result = partStr + units[unitIndex] + result;
                }
                num = Math.floor(num / 10000);
                unitIndex++;
            }
            return result;
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR');
        }

        init();
    </script>
</body>
</html>
