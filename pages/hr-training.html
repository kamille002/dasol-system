<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµìœ¡ ê´€ë¦¬ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: #f3f4f6;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 24px;
            color: #111827;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        
        .content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 24px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        thead {
            background: #f9fafb;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        td {
            color: #6b7280;
            font-size: 14px;
        }
        tr:hover {
            background: #f9fafb;
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-scheduled { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .status-cancelled { background: #fee2e2; color: #991b1b; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 24px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“š êµìœ¡ ê´€ë¦¬</h1>
        <div style="display: flex; gap: 12px;">
            <button class="btn btn-success" onclick="generateTrainingLedger()" style="background: #10b981;">ğŸ“„ êµìœ¡ ì´ë ¥ ëŒ€ì¥ ì¶œë ¥</button>
            <button class="btn btn-primary" onclick="openAddModal()">+ êµìœ¡ ë“±ë¡</button>
            <button class="btn btn-primary" onclick="history.back()">â† ë’¤ë¡œ</button>
            <button class="btn btn-secondary" onclick="window.location.href='../dashboard-tabs.html'">ğŸ  ëŒ€ì‹œë³´ë“œ</button>
        </div>
    </div>

    <div class="content">
        <table>
            <thead>
                <tr>
                    <th>êµìœ¡ëª…</th>
                    <th>êµìœ¡ì¼ì‹œ</th>
                    <th>ê°•ì‚¬</th>
                    <th>ëŒ€ìƒì</th>
                    <th>ì¥ì†Œ</th>
                    <th>ìƒíƒœ</th>
                    <th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody id="trainingTable"></tbody>
        </table>
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">êµìœ¡ ë“±ë¡</div>
            <form id="trainingForm">
                <div class="form-group">
                    <label>êµìœ¡ëª…</label>
                    <input type="text" id="title" placeholder="ì˜ˆ: ì•ˆì „êµìœ¡, ì‹¤í—˜ì‹¤ êµìœ¡" required>
                </div>
                <div class="form-group">
                    <label>êµìœ¡ì¼ì‹œ</label>
                    <input type="datetime-local" id="datetime" required>
                </div>
                <div class="form-group">
                    <label>ê°•ì‚¬</label>
                    <input type="text" id="instructor" placeholder="ë‚´ë¶€ê°•ì‚¬ ë˜ëŠ” ì™¸ë¶€ê°•ì‚¬" required>
                </div>
                <div class="form-group">
                    <label>ëŒ€ìƒì</label>
                    <input type="text" id="participants" placeholder="ì „ì²´ ë˜ëŠ” íŠ¹ì • ë¶€ì„œ" required>
                </div>
                <div class="form-group">
                    <label>ì¥ì†Œ</label>
                    <input type="text" id="location" placeholder="ì˜ˆ: íšŒì˜ì‹¤, ì‹¤í—˜ì‹¤" required>
                </div>
                <div class="form-group">
                    <label>êµìœ¡ ë‚´ìš©</label>
                    <textarea id="description" rows="4" placeholder="êµìœ¡ ë‚´ìš©ì„ ê°„ëµíˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ë“±ë¡</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let trainings = [];

        function init() {
            loadTrainings();
            renderTable();
        }

        function loadTrainings() {
            trainings = JSON.parse(localStorage.getItem('dasol_trainings') || '[]');
        }

        function renderTable() {
            const tbody = document.getElementById('trainingTable');

            if (trainings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 60px; color: #9ca3af;">ë“±ë¡ëœ êµìœ¡ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            tbody.innerHTML = trainings.map(training => {
                const status = getStatus(training);
                
                return `
                    <tr>
                        <td><strong>${training.title}</strong></td>
                        <td>${formatDateTime(training.datetime)}</td>
                        <td>${training.instructor}</td>
                        <td>${training.participants}</td>
                        <td>${training.location}</td>
                        <td>
                            <span class="status-badge status-${status}">
                                ${status === 'scheduled' ? 'ì˜ˆì •' : status === 'completed' ? 'ì™„ë£Œ' : 'ì·¨ì†Œ'}
                            </span>
                        </td>
                        <td>
                            ${status === 'scheduled' ? `
                                <button class="btn btn-success" onclick="completeTraining('${training.id}')">ì™„ë£Œ</button>
                            ` : ''}
                            <button class="btn btn-secondary" onclick="deleteTraining('${training.id}')">ì‚­ì œ</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getStatus(training) {
            if (training.status === 'completed') return 'completed';
            if (training.status === 'cancelled') return 'cancelled';
            
            const now = new Date();
            const trainingDate = new Date(training.datetime);
            return trainingDate > now ? 'scheduled' : 'completed';
        }

        function formatDateTime(datetimeString) {
            const date = new Date(datetimeString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function openAddModal() {
            document.getElementById('addModal').classList.add('show');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('show');
            document.getElementById('trainingForm').reset();
        }

        document.getElementById('trainingForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const newTraining = {
                id: 'TRAIN' + Date.now(),
                title: document.getElementById('title').value,
                datetime: document.getElementById('datetime').value,
                instructor: document.getElementById('instructor').value,
                participants: document.getElementById('participants').value,
                location: document.getElementById('location').value,
                description: document.getElementById('description').value,
                status: 'scheduled',
                createdAt: new Date().toISOString()
            };

            trainings.push(newTraining);
            localStorage.setItem('dasol_trainings', JSON.stringify(trainings));

            closeAddModal();
            renderTable();
            alert('êµìœ¡ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        function completeTraining(id) {
            const training = trainings.find(t => t.id === id);
            if (training) {
                training.status = 'completed';
                localStorage.setItem('dasol_trainings', JSON.stringify(trainings));
                renderTable();
            }
        }

        function deleteTraining(id) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            trainings = trainings.filter(t => t.id !== id);
            localStorage.setItem('dasol_trainings', JSON.stringify(trainings));
            renderTable();
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        }

        // êµìœ¡ ì´ë ¥ ëŒ€ì¥ ì¶œë ¥
        function generateTrainingLedger() {
            const allTrainings = JSON.parse(localStorage.getItem('dasol_trainings') || '[]');
            
            if (allTrainings.length === 0) {
                alert('ë“±ë¡ëœ êµìœ¡ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const today = new Date().toLocaleDateString('ko-KR');
            
            let html = `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>êµìœ¡ ì´ë ¥ ëŒ€ì¥ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
                    <style>
                        @page { size: A4 landscape; margin: 15mm; }
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body {
                            font-family: 'Malgun Gothic', sans-serif;
                            padding: 20px;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 20px;
                        }
                        .header h1 {
                            font-size: 24px;
                            margin-bottom: 10px;
                        }
                        .header .info {
                            font-size: 12px;
                            color: #666;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            font-size: 11px;
                        }
                        th, td {
                            border: 1px solid #000;
                            padding: 6px 4px;
                            text-align: center;
                        }
                        th {
                            background: #f0f0f0;
                            font-weight: 700;
                        }
                        @media print {
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</h1>
                        <h2>êµìœ¡ ì´ë ¥ ëŒ€ì¥</h2>
                        <div class="info">ì¶œë ¥ì¼: ${today}</div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 50px;">ë²ˆí˜¸</th>
                                <th style="width: 150px;">êµìœ¡ëª…</th>
                                <th style="width: 120px;">êµìœ¡ì¼ì‹œ</th>
                                <th style="width: 80px;">êµìœ¡ì‹œê°„</th>
                                <th style="width: 100px;">êµìœ¡ê¸°ê´€</th>
                                <th style="width: 100px;">êµìœ¡ì¥ì†Œ</th>
                                <th>ì°¸ì„ì</th>
                                <th style="width: 100px;">ê°•ì‚¬</th>
                                <th>ë¹„ê³ </th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allTrainings.map((training, index) => {
                                return `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${training.trainingName}</td>
                                        <td>${formatDateTime(training.trainingDate, training.trainingTime)}</td>
                                        <td>${training.duration || '-'}ì‹œê°„</td>
                                        <td>${training.organization || '-'}</td>
                                        <td>${training.location || '-'}</td>
                                        <td style="text-align: left; padding-left: 8px;">${training.attendees ? training.attendees.join(', ') : '-'}</td>
                                        <td>${training.instructor || '-'}</td>
                                        <td>${training.notes || '-'}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    
                    <div class="no-print" style="margin-top: 20px; text-align: center;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">ğŸ–¨ï¸ ì¸ì‡„</button>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; margin-left: 10px;">ë‹«ê¸°</button>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank', 'width=1200,height=800');
            printWindow.document.write(html);
            printWindow.document.close();
        }

        init();
    </script>
</body>
</html>
