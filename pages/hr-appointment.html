<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì‚¬ë°œë ¹ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 28px; }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary { background: white; color: #667eea; }
        .btn-success { background: #10b981; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .card h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #1f2937;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        .order-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .order-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .order-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        .order-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .order-card p {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-approved { background: #d1fae5; color: #065f46; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        .type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .type-appointment { background: #dbeafe; color: #1e40af; }
        .type-reward { background: #fce7f3; color: #9f1239; }
        .type-discipline { background: #fee2e2; color: #991b1b; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2 { font-size: 24px; }
        .modal-body { padding: 25px; }
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }
        .approval-info {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        .approval-info p {
            margin-bottom: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ ì¸ì‚¬ë°œë ¹ ê´€ë¦¬</h1>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-success" onclick="openModal()">+ ì‹ ê·œ ë°œë ¹</button>
                <button class="btn btn-primary" onclick="window.location.href='../dashboard-tabs.html'">â† ëŒ€ì‹œë³´ë“œ</button>
            </div>
        </div>

        <!-- ë°œë ¹ í˜„í™© -->
        <div class="grid-3">
            <div class="card" style="text-align: center;">
                <p style="color: #6b7280; margin-bottom: 5px;">ëŒ€ê¸°ì¤‘</p>
                <h2 style="font-size: 32px; color: #f59e0b; border: none; padding: 0;" id="pendingCount">0</h2>
            </div>
            <div class="card" style="text-align: center;">
                <p style="color: #6b7280; margin-bottom: 5px;">ìŠ¹ì¸</p>
                <h2 style="font-size: 32px; color: #10b981; border: none; padding: 0;" id="approvedCount">0</h2>
            </div>
            <div class="card" style="text-align: center;">
                <p style="color: #6b7280; margin-bottom: 5px;">ë°˜ë ¤</p>
                <h2 style="font-size: 32px; color: #ef4444; border: none; padding: 0;" id="rejectedCount">0</h2>
            </div>
        </div>

        <!-- ë°œë ¹ ëª©ë¡ -->
        <div class="card">
            <h2>ğŸ“‹ ë°œë ¹ ëª©ë¡</h2>
            <div id="orderList" class="order-list"></div>
        </div>
    </div>

    <!-- ì‹ ê·œ ë°œë ¹ ëª¨ë‹¬ -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ì‹ ê·œ ì¸ì‚¬ë°œë ¹</h2>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="orderForm">
                    <!-- ë°œë ¹ êµ¬ë¶„ -->
                    <div class="form-group">
                        <label>ë°œë ¹ êµ¬ë¶„ *</label>
                        <select id="orderType" required onchange="updateFormFields()">
                            <option value="">ì„ íƒ</option>
                            <option value="ì¸ì‚¬ë°œë ¹">ì¸ì‚¬ë°œë ¹ (ë¶€ì„œì´ë™, ì§ê¸‰ë³€ê²½ ë“±)</option>
                            <option value="í¬ìƒ">í¬ìƒ</option>
                            <option value="ì§•ê³„">ì§•ê³„</option>
                        </select>
                    </div>

                    <!-- ëŒ€ìƒ ì§ì› -->
                    <div class="form-group">
                        <label>ëŒ€ìƒ ì§ì› *</label>
                        <select id="targetEmployee" required onchange="loadEmployeeInfo()">
                            <option value="">ì„ íƒ</option>
                        </select>
                    </div>

                    <!-- í˜„ì¬ ì •ë³´ (ìë™ í‘œì‹œ) -->
                    <div id="currentInfo" style="display: none;">
                        <div class="approval-info">
                            <strong>í˜„ì¬ ì •ë³´</strong>
                            <p id="current_dept">ë¶€ì„œ: -</p>
                            <p id="current_position">ì§ê¸‰: -</p>
                        </div>
                    </div>

                    <!-- ì¸ì‚¬ë°œë ¹ ìƒì„¸ -->
                    <div id="appointmentFields" style="display: none;">
                        <div class="grid-2" style="margin-top: 20px;">
                            <div class="form-group">
                                <label>ë³€ê²½ ë¶€ì„œ</label>
                                <select id="newDepartment">
                                    <option value="">ë³€ê²½ì—†ìŒ</option>
                                    <option value="ì˜ì—…1íŒ€">ì˜ì—…1íŒ€</option>
                                    <option value="ì˜ì—…2íŒ€">ì˜ì—…2íŒ€</option>
                                    <option value="ì´ë¬´íŒ€">ì´ë¬´íŒ€</option>
                                    <option value="ë¶„ì„íŒ€">ë¶„ì„íŒ€</option>
                                    <option value="ìˆ˜ì§ˆìê°€ì¸¡ì •íŒ€">ìˆ˜ì§ˆìê°€ì¸¡ì •íŒ€</option>
                                    <option value="ë¨¹ëŠ”ë¬¼ê²€ì‚¬íŒ€">ë¨¹ëŠ”ë¬¼ê²€ì‚¬íŒ€</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ë³€ê²½ ì§ê¸‰</label>
                                <select id="newPosition">
                                    <option value="">ë³€ê²½ì—†ìŒ</option>
                                    <option value="ì‚¬ì›">ì‚¬ì›</option>
                                    <option value="ì£¼ì„">ì£¼ì„</option>
                                    <option value="ëŒ€ë¦¬">ëŒ€ë¦¬</option>
                                    <option value="ê³¼ì¥">ê³¼ì¥</option>
                                    <option value="ë¶€ì¥">ë¶€ì¥</option>
                                    <option value="ì‹¤ì¥">ì‹¤ì¥</option>
                                    <option value="ì´ì‚¬">ì´ì‚¬</option>
                                    <option value="ëŒ€í‘œì´ì‚¬">ëŒ€í‘œì´ì‚¬</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- í¬ìƒ ìƒì„¸ -->
                    <div id="rewardFields" style="display: none;">
                        <div class="form-group" style="margin-top: 20px;">
                            <label>í¬ìƒ ì¢…ë¥˜</label>
                            <select id="rewardType">
                                <option value="í‘œì°½ì¥">í‘œì°½ì¥</option>
                                <option value="ê°ì‚¬ì¥">ê°ì‚¬ì¥</option>
                                <option value="ê³µë¡œìƒ">ê³µë¡œìƒ</option>
                                <option value="ëª¨ë²”ìƒ">ëª¨ë²”ìƒ</option>
                                <option value="ìƒê¸ˆ">ìƒê¸ˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>í¬ìƒ ê¸ˆì•¡ (ì„ íƒ)</label>
                            <input type="number" id="rewardAmount" placeholder="ê¸ˆì•¡ (ì›)">
                        </div>
                    </div>

                    <!-- ì§•ê³„ ìƒì„¸ -->
                    <div id="disciplineFields" style="display: none;">
                        <div class="form-group" style="margin-top: 20px;">
                            <label>ì§•ê³„ ì¢…ë¥˜</label>
                            <select id="disciplineType">
                                <option value="ê²½ê³ ">ê²½ê³ </option>
                                <option value="ê²¬ì±…">ê²¬ì±…</option>
                                <option value="ê°ë´‰">ê°ë´‰</option>
                                <option value="ì •ì§">ì •ì§</option>
                                <option value="í•´ê³ ">í•´ê³ </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì§•ê³„ ê¸°ê°„ (ì •ì§ì˜ ê²½ìš°)</label>
                            <input type="text" id="disciplinePeriod" placeholder="ì˜ˆ: 3ê°œì›”">
                        </div>
                    </div>

                    <!-- ê³µí†µ -->
                    <div class="form-group">
                        <label>ë°œë ¹ì¼ *</label>
                        <input type="date" id="effectiveDate" required>
                    </div>

                    <div class="form-group">
                        <label>ì‚¬ìœ  *</label>
                        <textarea id="reason" rows="4" placeholder="ë°œë ¹ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="submitOrder()">ì´ë¬´íŒ€ â†’ ëŒ€í‘œì´ì‚¬ ê²°ì¬ ìš”ì²­</button>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ì¸ì‚¬ë°œë ¹ ìƒì„¸</h2>
                <button class="close-btn" onclick="closeDetailModal()">Ã—</button>
            </div>
            <div class="modal-body" id="detailContent">
            </div>
            <div class="modal-footer" id="detailActions">
            </div>
        </div>
    </div>

    <script>
        let employees = [];
        let orders = [];
        let currentUser = 'ì´ë¬´íŒ€'; // ì„ì‹œ (ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ ì •ë³´)

        window.addEventListener('load', () => {
            loadData();
            renderOrders();
            updateCounts();
        });

        function loadData() {
            // ì§ì› ëª©ë¡
            employees = JSON.parse(localStorage.getItem('dasol_employees') || '[]');
            const select = document.getElementById('targetEmployee');
            employees.filter(e => e.status === 'ì¬ì§ì¤‘').forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = `${emp.name} - ${emp.department} ${emp.currentPosition || emp.position || ''}`;
                select.appendChild(option);
            });

            // ë°œë ¹ ëª©ë¡
            orders = JSON.parse(localStorage.getItem('dasol_hr_orders') || '[]');
        }

        function updateFormFields() {
            const type = document.getElementById('orderType').value;
            
            document.getElementById('appointmentFields').style.display = 'none';
            document.getElementById('rewardFields').style.display = 'none';
            document.getElementById('disciplineFields').style.display = 'none';

            if (type === 'ì¸ì‚¬ë°œë ¹') {
                document.getElementById('appointmentFields').style.display = 'block';
            } else if (type === 'í¬ìƒ') {
                document.getElementById('rewardFields').style.display = 'block';
            } else if (type === 'ì§•ê³„') {
                document.getElementById('disciplineFields').style.display = 'block';
            }
        }

        function loadEmployeeInfo() {
            const empId = document.getElementById('targetEmployee').value;
            if (!empId) return;

            const emp = employees.find(e => e.id === empId);
            if (!emp) return;

            document.getElementById('current_dept').textContent = `ë¶€ì„œ: ${emp.department}`;
            document.getElementById('current_position').textContent = `ì§ê¸‰: ${emp.currentPosition || emp.position || '-'}`;
            document.getElementById('currentInfo').style.display = 'block';
        }

        function openModal() {
            document.getElementById('orderForm').reset();
            document.getElementById('currentInfo').style.display = 'none';
            document.getElementById('appointmentFields').style.display = 'none';
            document.getElementById('rewardFields').style.display = 'none';
            document.getElementById('disciplineFields').style.display = 'none';
            document.getElementById('orderModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('orderModal').classList.remove('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function submitOrder() {
            const form = document.getElementById('orderForm');
            if (!form.checkValidity()) {
                alert('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const empId = document.getElementById('targetEmployee').value;
            const employee = employees.find(e => e.id === empId);

            const orderData = {
                id: `ORDER-${Date.now()}`,
                type: document.getElementById('orderType').value,
                employeeId: empId,
                employeeName: employee.name,
                currentDepartment: employee.department,
                currentPosition: employee.currentPosition || employee.position,
                effectiveDate: document.getElementById('effectiveDate').value,
                reason: document.getElementById('reason').value,
                status: 'pending', // pending/approved/rejected
                createdBy: currentUser,
                createdAt: new Date().toISOString(),
                approvedBy: null,
                approvedAt: null
            };

            // ë°œë ¹ ì¢…ë¥˜ë³„ ìƒì„¸ ì •ë³´
            if (orderData.type === 'ì¸ì‚¬ë°œë ¹') {
                orderData.newDepartment = document.getElementById('newDepartment').value || employee.department;
                orderData.newPosition = document.getElementById('newPosition').value || (employee.currentPosition || employee.position);
            } else if (orderData.type === 'í¬ìƒ') {
                orderData.rewardType = document.getElementById('rewardType').value;
                orderData.rewardAmount = document.getElementById('rewardAmount').value;
            } else if (orderData.type === 'ì§•ê³„') {
                orderData.disciplineType = document.getElementById('disciplineType').value;
                orderData.disciplinePeriod = document.getElementById('disciplinePeriod').value;
            }

            orders.push(orderData);
            localStorage.setItem('dasol_hr_orders', JSON.stringify(orders));

            alert('âœ… ëŒ€í‘œì´ì‚¬ì—ê²Œ ê²°ì¬ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeModal();
            renderOrders();
            updateCounts();
        }

        function renderOrders() {
            const container = document.getElementById('orderList');
            
            if (orders.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; grid-column: 1/-1;">ë“±ë¡ëœ ë°œë ¹ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // ìµœì‹ ìˆœ ì •ë ¬
            const sorted = [...orders].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            container.innerHTML = sorted.map(order => `
                <div class="order-card" onclick="viewDetail('${order.id}')">
                    <span class="type-badge type-${order.type === 'ì¸ì‚¬ë°œë ¹' ? 'appointment' : order.type === 'í¬ìƒ' ? 'reward' : 'discipline'}">
                        ${order.type}
                    </span>
                    <h3>${order.employeeName}</h3>
                    <p>ë¶€ì„œ: ${order.currentDepartment} ${order.type === 'ì¸ì‚¬ë°œë ¹' && order.newDepartment !== order.currentDepartment ? 'â†’ ' + order.newDepartment : ''}</p>
                    <p>ì§ê¸‰: ${order.currentPosition} ${order.type === 'ì¸ì‚¬ë°œë ¹' && order.newPosition !== order.currentPosition ? 'â†’ ' + order.newPosition : ''}</p>
                    <p>ë°œë ¹ì¼: ${order.effectiveDate}</p>
                    <p>ì‘ì„±ì: ${order.createdBy}</p>
                    <span class="status-badge status-${order.status}">
                        ${order.status === 'pending' ? 'ëŒ€ê¸°ì¤‘' : order.status === 'approved' ? 'ìŠ¹ì¸' : 'ë°˜ë ¤'}
                    </span>
                </div>
            `).join('');
        }

        function updateCounts() {
            document.getElementById('pendingCount').textContent = orders.filter(o => o.status === 'pending').length;
            document.getElementById('approvedCount').textContent = orders.filter(o => o.status === 'approved').length;
            document.getElementById('rejectedCount').textContent = orders.filter(o => o.status === 'rejected').length;
        }

        function viewDetail(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            let detailHTML = `
                <div class="approval-info">
                    <h3 style="margin-bottom: 15px;">${order.type}</h3>
                    <p><strong>ëŒ€ìƒ ì§ì›:</strong> ${order.employeeName}</p>
                    <p><strong>ë°œë ¹ì¼:</strong> ${order.effectiveDate}</p>
                    <p><strong>ì‘ì„±ì:</strong> ${order.createdBy}</p>
                    <p><strong>ì‘ì„±ì¼:</strong> ${new Date(order.createdAt).toLocaleString('ko-KR')}</p>
                    <p><strong>ìƒíƒœ:</strong> ${order.status === 'pending' ? 'ëŒ€ê¸°ì¤‘' : order.status === 'approved' ? 'ìŠ¹ì¸' : 'ë°˜ë ¤'}</p>
                </div>
                <div style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px;">ë°œë ¹ ë‚´ìš©</h4>
            `;

            if (order.type === 'ì¸ì‚¬ë°œë ¹') {
                detailHTML += `
                    <p><strong>í˜„ì¬ ë¶€ì„œ:</strong> ${order.currentDepartment} â†’ <strong>ë³€ê²½ ë¶€ì„œ:</strong> ${order.newDepartment}</p>
                    <p><strong>í˜„ì¬ ì§ê¸‰:</strong> ${order.currentPosition} â†’ <strong>ë³€ê²½ ì§ê¸‰:</strong> ${order.newPosition}</p>
                `;
            } else if (order.type === 'í¬ìƒ') {
                detailHTML += `
                    <p><strong>í¬ìƒ ì¢…ë¥˜:</strong> ${order.rewardType}</p>
                    ${order.rewardAmount ? `<p><strong>í¬ìƒ ê¸ˆì•¡:</strong> ${parseInt(order.rewardAmount).toLocaleString()}ì›</p>` : ''}
                `;
            } else if (order.type === 'ì§•ê³„') {
                detailHTML += `
                    <p><strong>ì§•ê³„ ì¢…ë¥˜:</strong> ${order.disciplineType}</p>
                    ${order.disciplinePeriod ? `<p><strong>ì§•ê³„ ê¸°ê°„:</strong> ${order.disciplinePeriod}</p>` : ''}
                `;
            }

            detailHTML += `
                    <p style="margin-top: 15px;"><strong>ì‚¬ìœ :</strong></p>
                    <p style="white-space: pre-wrap; background: #f9fafb; padding: 15px; border-radius: 8px; margin-top: 10px;">${order.reason}</p>
                </div>
            `;

            document.getElementById('detailContent').innerHTML = detailHTML;

            // ê²°ì¬ ë²„íŠ¼ (ëŒ€í‘œì´ì‚¬ë§Œ)
            let actionsHTML = '';
            if (currentUser === 'ëŒ€í‘œì´ì‚¬' && order.status === 'pending') {
                actionsHTML = `
                    <button class="btn btn-success" onclick="approveOrder('${order.id}')">âœ… ìŠ¹ì¸</button>
                    <button class="btn btn-danger" onclick="rejectOrder('${order.id}')">âŒ ë°˜ë ¤</button>
                `;
            }
            actionsHTML += `<button class="btn btn-secondary" onclick="closeDetailModal()">ë‹«ê¸°</button>`;
            document.getElementById('detailActions').innerHTML = actionsHTML;

            document.getElementById('detailModal').classList.add('active');
        }

        function approveOrder(orderId) {
            if (!confirm('ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìŠ¹ì¸ ì‹œ ì¸ì‚¬ì¹´ë“œì— ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.')) return;

            const orderIndex = orders.findIndex(o => o.id === orderId);
            const order = orders[orderIndex];
            
            order.status = 'approved';
            order.approvedBy = currentUser;
            order.approvedAt = new Date().toISOString();

            // ì¸ì‚¬ì¹´ë“œì— ìë™ ë°˜ì˜
            const empIndex = employees.findIndex(e => e.id === order.employeeId);
            if (empIndex !== -1) {
                if (order.type === 'ì¸ì‚¬ë°œë ¹') {
                    employees[empIndex].department = order.newDepartment;
                    employees[empIndex].currentPosition = order.newPosition;
                }
                
                // ì¸ì‚¬ ì´ë ¥ ì¶”ê°€
                if (!employees[empIndex].hrHistory) {
                    employees[empIndex].hrHistory = [];
                }
                employees[empIndex].hrHistory.push({
                    type: order.type,
                    date: order.effectiveDate,
                    details: order,
                    approvedAt: order.approvedAt
                });
                
                localStorage.setItem('dasol_employees', JSON.stringify(employees));
            }

            localStorage.setItem('dasol_hr_orders', JSON.stringify(orders));

            alert('âœ… ìŠ¹ì¸ë˜ì—ˆìœ¼ë©° ì¸ì‚¬ì¹´ë“œì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
            closeDetailModal();
            renderOrders();
            updateCounts();
        }

        function rejectOrder(orderId) {
            const reason = prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (!reason) return;

            const orderIndex = orders.findIndex(o => o.id === orderId);
            orders[orderIndex].status = 'rejected';
            orders[orderIndex].rejectedBy = currentUser;
            orders[orderIndex].rejectedAt = new Date().toISOString();
            orders[orderIndex].rejectReason = reason;

            localStorage.setItem('dasol_hr_orders', JSON.stringify(orders));

            alert('âŒ ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeDetailModal();
            renderOrders();
            updateCounts();
        }
    </script>
</body>
</html>
