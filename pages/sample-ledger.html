<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œë£Œ ì ‘ìˆ˜/ë°œì†¡ ëŒ€ì¥ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: #f3f4f6;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 24px;
            color: #111827;
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 24px;
        }
        
        .filter-section {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            align-items: center;
        }
        .filter-section input {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        th, td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
        }
        tr:hover {
            background: #f9fafb;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
        }
        .status-received {
            background: #dbeafe;
            color: #1e40af;
        }
        .status-testing {
            background: #fef3c7;
            color: #92400e;
        }
        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }
        .status-sent {
            background: #e5e7eb;
            color: #6b7280;
        }
        
        @media print {
            .no-print { display: none !important; }
            body {
                background: white;
                padding: 10px;
            }
            .header {
                box-shadow: none;
                border-bottom: 2px solid #000;
            }
            table {
                font-size: 10px;
            }
            th, td {
                padding: 6px 4px;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“‹ ì‹œë£Œ ì ‘ìˆ˜/ë°œì†¡ ëŒ€ì¥</h1>
        <div class="header-actions no-print">
            <button class="btn btn-success" onclick="printLedger()">ğŸ–¨ï¸ ëŒ€ì¥ ì¶œë ¥</button>
            <button class="btn btn-secondary" onclick="window.location.href='../dashboard-tabs.html'">â† ëŒ€ì‹œë³´ë“œ</button>
        </div>
    </div>

    <div class="content">
        <div class="filter-section no-print">
            <label style="font-weight: 600;">ê¸°ê°„:</label>
            <input type="date" id="startDate">
            <span>~</span>
            <input type="date" id="endDate">
            <button class="btn btn-primary" onclick="filterByDate()">ì¡°íšŒ</button>
            <button class="btn btn-secondary" onclick="resetFilter()">ì „ì²´</button>
        </div>

        <div style="margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 14px; color: #6b7280;">
                ì´ <strong id="totalCount">0</strong>ê±´
            </div>
            <div style="font-size: 12px; color: #6b7280;" class="no-print">
                * ì˜ë¢°ì„œ ë“±ë¡ ì‹œ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤
            </div>
        </div>

        <div style="overflow-x: auto;">
            <table id="ledgerTable">
                <thead>
                    <tr>
                        <th style="width: 80px;">ì ‘ìˆ˜ì¼</th>
                        <th style="width: 120px;">ì ‘ìˆ˜ë²ˆí˜¸</th>
                        <th style="width: 80px;">ê²€ì²´ìœ í˜•</th>
                        <th style="width: 100px;">ê²€ì‚¬ëª©ì </th>
                        <th style="width: 120px;">ê´€ë ¨ë²•ë ¹</th>
                        <th>ì—…ì²´ëª…</th>
                        <th style="width: 100px;">ì˜ë¢°ì¸</th>
                        <th style="width: 120px;">ì£¼ì†Œ</th>
                        <th style="width: 80px;">ìƒíƒœ</th>
                        <th style="width: 100px;" class="no-print">ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody id="ledgerTableBody">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let allSamples = [];
        let filteredSamples = [];

        function init() {
            loadSamples();
            renderTable();
            
            // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì´ë²ˆ ë‹¬)
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('startDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
        }

        function loadSamples() {
            const requests = JSON.parse(localStorage.getItem('dasol_requests') || '[]');
            
            allSamples = requests.map(req => ({
                receiveDate: req.createdAt,
                receiveNumber: req.requestNumber,
                sampleType: req.sample.type,
                purpose: 'ì •ê¸°ê²€ì‚¬',
                law: getLawByType(req.sample.type),
                companyName: req.client.name,
                clientName: req.client.contact || '-',
                address: req.client.address,
                status: req.status,
                requestId: req.id
            }));

            filteredSamples = [...allSamples];
            document.getElementById('totalCount').textContent = allSamples.length;
        }

        function getLawByType(type) {
            const lawMap = {
                'ì €ìˆ˜ì¡°': 'ë¨¹ëŠ”ë¬¼ìˆ˜ì§ˆê¸°ì¤€',
                'ì˜¥ë‚´ê¸‰ìˆ˜ê´€': 'ë¨¹ëŠ”ë¬¼ìˆ˜ì§ˆê¸°ì¤€',
                'ì •ìˆ˜ê¸°': 'ë¨¹ëŠ”ë¬¼ìˆ˜ì§ˆê¸°ì¤€',
                'ìŒìš©ìˆ˜': 'ë¨¹ëŠ”ë¬¼ìˆ˜ì§ˆê¸°ì¤€',
                'ìƒí™œìš©ìˆ˜': 'ìƒí™œìš©ìˆ˜ìˆ˜ì§ˆê¸°ì¤€',
                'ì§€í•˜ìˆ˜': 'ì§€í•˜ìˆ˜ìˆ˜ì§ˆê¸°ì¤€'
            };
            return lawMap[type] || '-';
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'ì ‘ìˆ˜ì™„ë£Œ',
                'sampling': 'ì±„ìˆ˜ì™„ë£Œ',
                'testing': 'ë¶„ì„ì¤‘',
                'completed': 'ë¶„ì„ì™„ë£Œ',
                'sent': 'ë°œì†¡ì™„ë£Œ'
            };
            return statusMap[status] || status;
        }

        function getStatusClass(status) {
            if (status === 'pending') return 'status-received';
            if (status === 'sampling' || status === 'testing') return 'status-testing';
            if (status === 'completed') return 'status-completed';
            if (status === 'sent') return 'status-sent';
            return '';
        }

        function renderTable() {
            const tbody = document.getElementById('ledgerTableBody');
            
            if (filteredSamples.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="padding: 40px; text-align: center; color: #6b7280;">
                            ë“±ë¡ëœ ì‹œë£Œê°€ ì—†ìŠµë‹ˆë‹¤
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filteredSamples.map(sample => `
                <tr>
                    <td>${formatDate(sample.receiveDate)}</td>
                    <td style="font-weight: 600;">${sample.receiveNumber}</td>
                    <td>${sample.sampleType}</td>
                    <td>${sample.purpose}</td>
                    <td style="font-size: 11px;">${sample.law}</td>
                    <td style="text-align: left; padding-left: 12px;">${sample.companyName}</td>
                    <td>${sample.clientName}</td>
                    <td style="font-size: 11px; text-align: left;">${truncateText(sample.address, 20)}</td>
                    <td>
                        <span class="status-badge ${getStatusClass(sample.status)}">
                            ${getStatusText(sample.status)}
                        </span>
                    </td>
                    <td class="no-print">
                        <button onclick="viewRequest('${sample.requestId}')" style="padding: 4px 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">ìƒì„¸</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterByDate() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            endDate.setHours(23, 59, 59, 999);

            filteredSamples = allSamples.filter(sample => {
                const sampleDate = new Date(sample.receiveDate);
                return sampleDate >= startDate && sampleDate <= endDate;
            });

            document.getElementById('totalCount').textContent = filteredSamples.length;
            renderTable();
        }

        function resetFilter() {
            filteredSamples = [...allSamples];
            document.getElementById('totalCount').textContent = allSamples.length;
            
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('startDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            renderTable();
        }

        function viewRequest(requestId) {
            window.location.href = `request-register.html?id=${requestId}`;
        }

        function printLedger() {
            window.print();
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function truncateText(text, length) {
            if (!text) return '-';
            return text.length > length ? text.substring(0, length) + '...' : text;
        }

        init();
    </script>
</body>
</html>
