<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í˜„ì¥ ì˜ë¢°ì„œ ì‘ì„± - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: #f3f4f6;
            padding: 12px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            font-size: 22px;
            color: #111827;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 24px;
        }
        .section {
            margin-bottom: 24px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        .required {
            color: #ef4444;
            margin-left: 4px;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* ì‹œë£Œ ì…ë ¥ */
        .sample-grid {
            display: grid;
            gap: 12px;
        }
        .sample-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f9fafb;
            padding: 14px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }
        .sample-item.active {
            border-color: #667eea;
            background: #f0f9ff;
        }
        .sample-info {
            flex: 1;
        }
        .sample-name {
            font-size: 15px;
            font-weight: 700;
            color: #111827;
        }
        .sample-price {
            font-size: 13px;
            color: #6b7280;
            margin-top: 2px;
        }
        .sample-count {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .count-btn {
            width: 36px;
            height: 36px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 8px;
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .count-btn:active {
            background: #667eea;
            color: white;
        }
        .count-input {
            width: 50px;
            height: 36px;
            text-align: center;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
        }
        
        /* ê¸ˆì•¡ í‘œì‹œ */
        .total-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        .total-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 6px;
        }
        .total-amount {
            font-size: 32px;
            font-weight: 700;
        }
        
        /* ì‚¬ì§„ ì´¬ì˜ */
        .photo-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .photo-btn {
            aspect-ratio: 1;
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            background: #f9fafb;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .photo-btn:active {
            background: #f3f4f6;
        }
        .photo-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        .photo-text {
            font-size: 13px;
            color: #6b7280;
            font-weight: 600;
        }
        .photo-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .photo-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 16px;
            cursor: pointer;
            z-index: 10;
        }
        
        /* ë²„íŠ¼ */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            margin-top: 24px;
        }
        .btn-primary:active {
            transform: scale(0.98);
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
            margin-top: 12px;
        }
        
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ í˜„ì¥ ì˜ë¢°ì„œ ì‘ì„±</h1>
        <p class="subtitle">ì±„ìˆ˜ ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ì—…ë¬´ì¼ì§€ì— ì¶”ê°€ë©ë‹ˆë‹¤</p>

        <form id="fieldRequestForm">
            <!-- ê±°ë˜ì²˜ ì •ë³´ -->
            <div class="section">
                <div class="section-title">ê±°ë˜ì²˜ ì •ë³´</div>
                
                <div class="form-group">
                    <label>ê±°ë˜ì²˜ëª… <span class="required">*</span></label>
                    <input type="text" id="clientName" placeholder="ì˜ˆ: ABCê±´ë¬¼" required>
                </div>

                <div class="form-group">
                    <label>ì±„ìˆ˜ ì£¼ì†Œ <span class="required">*</span></label>
                    <input type="text" id="address" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123" required>
                </div>
            </div>

            <!-- ì‹œë£Œ ì •ë³´ -->
            <div class="section">
                <div class="section-title">ì‹œë£Œ ì¢…ë¥˜ ë° ê°œìˆ˜</div>
                
                <div class="sample-grid">
                    <div class="sample-item" data-type="ì €ìˆ˜ì¡°" data-price="60000">
                        <div class="sample-info">
                            <div class="sample-name">ì €ìˆ˜ì¡°</div>
                            <div class="sample-price">60,000ì› / ê°œ</div>
                        </div>
                        <div class="sample-count">
                            <button type="button" class="count-btn" onclick="decreaseCount('ì €ìˆ˜ì¡°')">-</button>
                            <input type="number" class="count-input" id="count-ì €ìˆ˜ì¡°" value="0" min="0" readonly>
                            <button type="button" class="count-btn" onclick="increaseCount('ì €ìˆ˜ì¡°')">+</button>
                        </div>
                    </div>

                    <div class="sample-item" data-type="ì •ìˆ˜ê¸°" data-price="50000">
                        <div class="sample-info">
                            <div class="sample-name">ì •ìˆ˜ê¸°</div>
                            <div class="sample-price">50,000ì› / ëŒ€</div>
                        </div>
                        <div class="sample-count">
                            <button type="button" class="count-btn" onclick="decreaseCount('ì •ìˆ˜ê¸°')">-</button>
                            <input type="number" class="count-input" id="count-ì •ìˆ˜ê¸°" value="0" min="0" readonly>
                            <button type="button" class="count-btn" onclick="increaseCount('ì •ìˆ˜ê¸°')">+</button>
                        </div>
                    </div>

                    <div class="sample-item" data-type="ì˜¥ë‚´ê¸‰ìˆ˜ê´€" data-price="55000">
                        <div class="sample-info">
                            <div class="sample-name">ì˜¥ë‚´ê¸‰ìˆ˜ê´€</div>
                            <div class="sample-price">55,000ì› / ê°œ</div>
                        </div>
                        <div class="sample-count">
                            <button type="button" class="count-btn" onclick="decreaseCount('ì˜¥ë‚´ê¸‰ìˆ˜ê´€')">-</button>
                            <input type="number" class="count-input" id="count-ì˜¥ë‚´ê¸‰ìˆ˜ê´€" value="0" min="0" readonly>
                            <button type="button" class="count-btn" onclick="increaseCount('ì˜¥ë‚´ê¸‰ìˆ˜ê´€')">+</button>
                        </div>
                    </div>

                    <div class="sample-item" data-type="ì§€í•˜ìˆ˜" data-price="100000">
                        <div class="sample-info">
                            <div class="sample-name">ì§€í•˜ìˆ˜</div>
                            <div class="sample-price">100,000ì› / ê°œ</div>
                        </div>
                        <div class="sample-count">
                            <button type="button" class="count-btn" onclick="decreaseCount('ì§€í•˜ìˆ˜')">-</button>
                            <input type="number" class="count-input" id="count-ì§€í•˜ìˆ˜" value="0" min="0" readonly>
                            <button type="button" class="count-btn" onclick="increaseCount('ì§€í•˜ìˆ˜')">+</button>
                        </div>
                    </div>

                    <div class="sample-item" data-type="ìê°€ì¸¡ì •" data-price="80000">
                        <div class="sample-info">
                            <div class="sample-name">ìê°€ì¸¡ì •</div>
                            <div class="sample-price">80,000ì› / ê°œ</div>
                        </div>
                        <div class="sample-count">
                            <button type="button" class="count-btn" onclick="decreaseCount('ìê°€ì¸¡ì •')">-</button>
                            <input type="number" class="count-input" id="count-ìê°€ì¸¡ì •" value="0" min="0" readonly>
                            <button type="button" class="count-btn" onclick="increaseCount('ìê°€ì¸¡ì •')">+</button>
                        </div>
                    </div>

                    <div class="sample-item" data-type="ì—”ì§€ë‹ˆì–´ë§" data-price="150000">
                        <div class="sample-info">
                            <div class="sample-name">ì—”ì§€ë‹ˆì–´ë§</div>
                            <div class="sample-price">150,000ì› / ê±´</div>
                        </div>
                        <div class="sample-count">
                            <button type="button" class="count-btn" onclick="decreaseCount('ì—”ì§€ë‹ˆì–´ë§')">-</button>
                            <input type="number" class="count-input" id="count-ì—”ì§€ë‹ˆì–´ë§" value="0" min="0" readonly>
                            <button type="button" class="count-btn" onclick="increaseCount('ì—”ì§€ë‹ˆì–´ë§')">+</button>
                        </div>
                    </div>

                    <div class="sample-item" data-type="ìš©ì—­" data-price="200000">
                        <div class="sample-info">
                            <div class="sample-name">ìš©ì—­</div>
                            <div class="sample-price">200,000ì› / ê±´</div>
                        </div>
                        <div class="sample-count">
                            <button type="button" class="count-btn" onclick="decreaseCount('ìš©ì—­')">-</button>
                            <input type="number" class="count-input" id="count-ìš©ì—­" value="0" min="0" readonly>
                            <button type="button" class="count-btn" onclick="increaseCount('ìš©ì—­')">+</button>
                        </div>
                    </div>
                </div>

                <!-- ì˜ˆìƒ ë§¤ì¶œ -->
                <div class="total-box">
                    <div class="total-label">ì˜ˆìƒ ë§¤ì¶œ</div>
                    <div class="total-amount" id="totalAmount">0ì›</div>
                </div>
            </div>

            <!-- ì‹œë£Œ ì‚¬ì§„ -->
            <div class="section">
                <div class="section-title">ì‹œë£Œ ì‚¬ì§„ (ì„ íƒ)</div>
                
                <div class="photo-section">
                    <div class="photo-btn" onclick="document.getElementById('photo1').click()">
                        <div class="photo-icon">ğŸ“¸</div>
                        <div class="photo-text">ì‚¬ì§„ 1</div>
                        <img id="preview1" class="photo-preview" style="display: none;">
                        <button type="button" class="photo-delete" id="delete1" style="display: none;" onclick="deletePhoto(1, event)">âœ•</button>
                    </div>
                    <input type="file" id="photo1" accept="image/*" capture="environment" onchange="handlePhoto(1, event)">

                    <div class="photo-btn" onclick="document.getElementById('photo2').click()">
                        <div class="photo-icon">ğŸ“¸</div>
                        <div class="photo-text">ì‚¬ì§„ 2</div>
                        <img id="preview2" class="photo-preview" style="display: none;">
                        <button type="button" class="photo-delete" id="delete2" style="display: none;" onclick="deletePhoto(2, event)">âœ•</button>
                    </div>
                    <input type="file" id="photo2" accept="image/*" capture="environment" onchange="handlePhoto(2, event)">

                    <div class="photo-btn" onclick="document.getElementById('photo3').click()">
                        <div class="photo-icon">ğŸ“¸</div>
                        <div class="photo-text">ì‚¬ì§„ 3</div>
                        <img id="preview3" class="photo-preview" style="display: none;">
                        <button type="button" class="photo-delete" id="delete3" style="display: none;" onclick="deletePhoto(3, event)">âœ•</button>
                    </div>
                    <input type="file" id="photo3" accept="image/*" capture="environment" onchange="handlePhoto(3, event)">

                    <div class="photo-btn" onclick="document.getElementById('photo4').click()">
                        <div class="photo-icon">ğŸ“¸</div>
                        <div class="photo-text">ì‚¬ì§„ 4</div>
                        <img id="preview4" class="photo-preview" style="display: none;">
                        <button type="button" class="photo-delete" id="delete4" style="display: none;" onclick="deletePhoto(4, event)">âœ•</button>
                    </div>
                    <input type="file" id="photo4" accept="image/*" capture="environment" onchange="handlePhoto(4, event)">
                </div>
            </div>

            <!-- ì œì¶œ ë²„íŠ¼ -->
            <button type="submit" class="btn btn-primary">âœ… ì±„ìˆ˜ ì™„ë£Œ (ì—…ë¬´ì¼ì§€ ìë™ ì¶”ê°€)</button>
            <button type="button" class="btn btn-secondary" onclick="goBack()">ì·¨ì†Œ</button>
        </form>
    </div>

    <script>
        const samplePrices = {
            'ì €ìˆ˜ì¡°': 60000,
            'ì •ìˆ˜ê¸°': 50000,
            'ì˜¥ë‚´ê¸‰ìˆ˜ê´€': 55000,
            'ì§€í•˜ìˆ˜': 100000,
            'ìê°€ì¸¡ì •': 80000,
            'ì—”ì§€ë‹ˆì–´ë§': 150000,
            'ìš©ì—­': 200000
        };

        const photoData = {
            1: null,
            2: null,
            3: null,
            4: null
        };

        function increaseCount(type) {
            const input = document.getElementById(`count-${type}`);
            input.value = parseInt(input.value) + 1;
            updateTotal();
            updateItemStyle(type);
        }

        function decreaseCount(type) {
            const input = document.getElementById(`count-${type}`);
            if (parseInt(input.value) > 0) {
                input.value = parseInt(input.value) - 1;
                updateTotal();
                updateItemStyle(type);
            }
        }

        function updateItemStyle(type) {
            const item = document.querySelector(`[data-type="${type}"]`);
            const count = parseInt(document.getElementById(`count-${type}`).value);
            if (count > 0) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        }

        function updateTotal() {
            let total = 0;
            Object.keys(samplePrices).forEach(type => {
                const count = parseInt(document.getElementById(`count-${type}`).value);
                total += count * samplePrices[type];
            });
            document.getElementById('totalAmount').textContent = total.toLocaleString() + 'ì›';
        }

        function handlePhoto(index, event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                photoData[index] = e.target.result;
                document.getElementById(`preview${index}`).src = e.target.result;
                document.getElementById(`preview${index}`).style.display = 'block';
                document.getElementById(`delete${index}`).style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        function deletePhoto(index, event) {
            event.stopPropagation();
            photoData[index] = null;
            document.getElementById(`preview${index}`).style.display = 'none';
            document.getElementById(`delete${index}`).style.display = 'none';
            document.getElementById(`photo${index}`).value = '';
        }

        // í¼ ì œì¶œ
        document.getElementById('fieldRequestForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // ì‹œë£Œ ê°œìˆ˜ í™•ì¸
            let totalSamples = 0;
            const samples = [];
            Object.keys(samplePrices).forEach(type => {
                const count = parseInt(document.getElementById(`count-${type}`).value);
                if (count > 0) {
                    totalSamples += count;
                    samples.push({
                        type: type,
                        count: count,
                        price: samplePrices[type],
                        amount: count * samplePrices[type]
                    });
                }
            });

            if (totalSamples === 0) {
                alert('âŒ ì‹œë£Œë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì´ ê¸ˆì•¡ ê³„ì‚°
            const totalAmount = samples.reduce((sum, s) => sum + s.amount, 0);

            // í˜„ì¥ ì˜ë¢°ì„œ ë°ì´í„°
            const fieldRequest = {
                id: 'FIELD' + Date.now(),
                type: 'sampling',  // sampling ë˜ëŠ” sales
                
                clientName: document.getElementById('clientName').value,
                address: document.getElementById('address').value,
                
                samples: samples,
                totalSamples: totalSamples,
                totalAmount: totalAmount,
                
                photos: Object.values(photoData).filter(p => p !== null),
                
                createdAt: new Date().toISOString(),
                createdBy: JSON.parse(localStorage.getItem('dasol_session') || '{}').name || 'ì˜ì—…ì‚¬ì›'
            };

            // ì—…ë¬´ì¼ì§€ì— ì¶”ê°€
            const workLogs = JSON.parse(localStorage.getItem('dasol_work_logs') || '[]');
            workLogs.push(fieldRequest);
            localStorage.setItem('dasol_work_logs', JSON.stringify(workLogs));

            alert(`âœ… ì±„ìˆ˜ ì™„ë£Œ!\n\nê±°ë˜ì²˜: ${fieldRequest.clientName}\nì‹œë£Œ: ${totalSamples}ê°œ\nê¸ˆì•¡: ${totalAmount.toLocaleString()}ì›\n\nì—…ë¬´ì¼ì§€ì— ìë™ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            // ì—…ë¬´ì¼ì§€ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = 'work-log-daily.html';
        });

        function goBack() {
            if (confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.location.href = '../dashboard-tabs.html';
            }
        }
    </script>
</body>
</html>
