<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê±°ë˜ëª…ì„¸ì„œ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: #f3f4f6;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 32px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“ ê±°ë˜ëª…ì„¸ì„œ</h1>
        <button class="btn btn-secondary" onclick="window.location.href='../dashboard-tabs.html'">â† ëŒ€ì‹œë³´ë“œ</button>
    </div>

    <div class="content">
        <h2 style="margin-bottom: 24px;">ê±°ë˜ëª…ì„¸ì„œ ìƒì„±</h2>
        
        <div class="form-group">
            <label>ê²¬ì ì„œ ì„ íƒ</label>
            <select id="quoteSelect" onchange="loadQuoteData()">
                <option value="">ê²¬ì ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>

        <button class="btn btn-primary" onclick="generateStatement()" style="width: 100%; margin-top: 24px;">ê±°ë˜ëª…ì„¸ì„œ ìƒì„±</button>
    </div>

    <script>
        let quotes = [];

        function init() {
            quotes = JSON.parse(localStorage.getItem('dasol_quotes') || '[]');
            
            const select = document.getElementById('quoteSelect');
            select.innerHTML = '<option value="">ê²¬ì ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>' +
                quotes.filter(q => q.status === 'sent' || q.status === 'converted')
                    .map(q => `<option value="${q.id}">${q.quoteNumber} - ${q.clientName}</option>`)
                    .join('');
        }

        function loadQuoteData() {
            // ê²¬ì ì„œ ë°ì´í„° ë¡œë“œ
        }

        function generateStatement() {
            const quoteId = document.getElementById('quoteSelect').value;
            if (!quoteId) {
                alert('ê²¬ì ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const quote = quotes.find(q => q.id === quoteId);
            
            const html = `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <title>ê±°ë˜ëª…ì„¸ì„œ - ${quote.quoteNumber}</title>
                    <style>
                        @page { size: A4; margin: 20mm; }
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body {
                            font-family: 'Malgun Gothic', sans-serif;
                            padding: 20px;
                            line-height: 1.6;
                        }
                        .title {
                            text-align: center;
                            font-size: 28px;
                            font-weight: 700;
                            margin-bottom: 30px;
                            padding-bottom: 10px;
                            border-bottom: 3px double #000;
                        }
                        .info-section {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 20px;
                            margin-bottom: 30px;
                        }
                        .info-box {
                            border: 2px solid #000;
                            padding: 15px;
                        }
                        .info-box h3 {
                            text-align: center;
                            margin-bottom: 15px;
                            padding-bottom: 10px;
                            border-bottom: 1px solid #000;
                        }
                        .info-row {
                            display: grid;
                            grid-template-columns: 100px 1fr;
                            margin-bottom: 8px;
                            font-size: 13px;
                        }
                        .info-label {
                            font-weight: 700;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                        }
                        th, td {
                            border: 1px solid #000;
                            padding: 10px;
                            text-align: center;
                            font-size: 13px;
                        }
                        th {
                            background: #f0f0f0;
                            font-weight: 700;
                        }
                        .total-section {
                            text-align: right;
                            margin-top: 20px;
                        }
                        .total-row {
                            display: flex;
                            justify-content: flex-end;
                            gap: 20px;
                            margin-bottom: 8px;
                            font-size: 14px;
                        }
                        .total-row.grand {
                            font-size: 18px;
                            font-weight: 700;
                            border-top: 2px solid #000;
                            padding-top: 10px;
                            margin-top: 10px;
                        }
                        @media print {
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="title">ê±° ë˜ ëª… ì„¸ ì„œ</div>
                    
                    <div class="info-section">
                        <div class="info-box">
                            <h3>ìˆ˜ ì‹ </h3>
                            <div class="info-row">
                                <div class="info-label">ìƒ í˜¸</div>
                                <div>${quote.clientName} ê·€í•˜</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">ë‹´ë‹¹ì</div>
                                <div>${quote.clientContact || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">ì „ í™”</div>
                                <div>${quote.clientPhone || '-'}</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">ê¸ˆ ì•¡</div>
                                <div style="font-weight: 700;">ì¼ê¸ˆ${convertNumberToKorean(quote.grandTotal)}ì›ì • (â‚© ${quote.grandTotal.toLocaleString()})</div>
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <h3>ë°œ ì‹ </h3>
                            <div class="info-row">
                                <div class="info-label">ìƒ í˜¸</div>
                                <div>(ì£¼)ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">ëŒ€í‘œì´ì‚¬</div>
                                <div>ì‹¬íƒœë³´</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">ì£¼ ì†Œ</div>
                                <div>ê²½ê¸°ë„ í•˜ë‚¨ì‹œ ì´ˆê´‘ì‚°ë‹¨ë¡œ 126, ìš°ì¼ë¹Œë”© 3ì¸µ</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">ì „ í™”</div>
                                <div>031-772-4530</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">íŒ© ìŠ¤</div>
                                <div>031-775-4539</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">ì‘ì„±ì</div>
                                <div>${quote.createdBy}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <div class="info-row">
                            <div class="info-label">ê±°ë˜ì¼ì</div>
                            <div>${formatDate(quote.quoteDate)}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">ë¬¸ì„œë²ˆí˜¸</div>
                            <div>${quote.quoteNumber}</div>
                        </div>
                    </div>

                    <p style="margin: 20px 0; text-align: center;">í•˜ê¸°ì™€ ê°™ì´ ê±°ë˜ëª…ì„¸ì„œë¥¼ ì œì¶œí•©ë‹ˆë‹¤</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 50px;">ë²ˆí˜¸</th>
                                <th style="width: 100px;">êµ¬ë¶„</th>
                                <th>í’ˆëª…</th>
                                <th style="width: 100px;">ë‹¨ê°€</th>
                                <th style="width: 70px;">ìˆ˜ëŸ‰</th>
                                <th style="width: 120px;">ê¸ˆì•¡</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${quote.items.map((item, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>ìˆ˜ì§ˆê²€ì‚¬</td>
                                    <td style="text-align: left; padding-left: 10px;">${item.name}</td>
                                    <td style="text-align: right;">${item.price.toLocaleString()}</td>
                                    <td>${item.quantity}</td>
                                    <td style="text-align: right; font-weight: 700;">${item.amount.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                            ${Array(10 - quote.items.length).fill(0).map(() => `
                                <tr>
                                    <td>&nbsp;</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="total-section">
                        <div class="total-row">
                            <span>ê¸ˆì•¡:</span>
                            <span>${quote.subtotal.toLocaleString()}ì›</span>
                        </div>
                        <div class="total-row">
                            <span>ë¶€ê°€ì„¸:</span>
                            <span>${quote.vat.toLocaleString()}ì›</span>
                        </div>
                        <div class="total-row grand">
                            <span>í•©ê³„:</span>
                            <span>${quote.grandTotal.toLocaleString()}ì›</span>
                        </div>
                    </div>
                    
                    <div class="no-print" style="margin-top: 30px; text-align: center;">
                        <button onclick="window.print()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; margin-right: 10px;">ğŸ–¨ï¸ ì¸ì‡„</button>
                        <button onclick="window.close()" style="padding: 12px 24px; background: #6b7280; color: white; border: none; border-radius: 8px; font-size: 14px; cursor: pointer;">ë‹«ê¸°</button>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank', 'width=900,height=800');
            printWindow.document.write(html);
            printWindow.document.close();
        }

        function convertNumberToKorean(num) {
            const units = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
            const nums = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];
            const positions = ['', 'ì‹­', 'ë°±', 'ì²œ'];
            
            if (num === 0) return 'ì˜';
            
            let result = '';
            let unitIndex = 0;
            
            while (num > 0) {
                const part = num % 10000;
                if (part > 0) {
                    let partStr = '';
                    let tempPart = part;
                    let posIndex = 0;
                    
                    while (tempPart > 0) {
                        const digit = tempPart % 10;
                        if (digit > 0) {
                            partStr = nums[digit] + positions[posIndex] + partStr;
                        }
                        tempPart = Math.floor(tempPart / 10);
                        posIndex++;
                    }
                    
                    result = partStr + units[unitIndex] + result;
                }
                num = Math.floor(num / 10000);
                unitIndex++;
            }
            
            return result;
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR');
        }

        init();
    </script>
</body>
</html>
