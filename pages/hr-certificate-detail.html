<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìê²©ì¦ ìƒì„¸ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: #f3f4f6;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 24px;
            color: #111827;
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .cert-detail-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 32px;
            max-width: 900px;
            margin: 0 auto;
        }
        .card-title {
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 3px solid #111827;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }
        .info-cell {
            background: white;
            padding: 12px;
            font-size: 13px;
        }
        .info-label {
            font-weight: 700;
            color: #374151;
            background: #f9fafb;
        }
        .info-value {
            color: #111827;
        }
        .status-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            display: inline-block;
        }
        .status-valid {
            background: #d1fae5;
            color: #065f46;
        }
        .status-expiring {
            background: #fef3c7;
            color: #92400e;
        }
        .status-expired {
            background: #fee2e2;
            color: #991b1b;
        }
        .cert-photo {
            text-align: center;
            margin: 24px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }
        .cert-photo img {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        @media print {
            .header-actions,
            .btn,
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“œ ìê²©ì¦ ìƒì„¸</h1>
        <div class="header-actions">
            <button class="btn btn-success" onclick="editCertificate()">ìˆ˜ì •</button>
            <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
            <button class="btn btn-secondary" onclick="goBack()">â† ëª©ë¡</button>
        </div>
    </div>

    <div class="cert-detail-card" id="certDetailCard">
        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </div>

    <script>
        let currentCert = null;
        let certId = null;

        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            certId = urlParams.get('id');

            if (!certId) {
                alert('ìê²©ì¦ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                goBack();
                return;
            }

            loadCertificate();
        }

        function loadCertificate() {
            const certificates = JSON.parse(localStorage.getItem('dasol_certificates') || '[]');
            currentCert = certificates.find(c => c.id === certId);

            if (!currentCert) {
                alert('ìê²©ì¦ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                goBack();
                return;
            }

            renderCertificateCard();
        }

        function renderCertificateCard() {
            const cert = currentCert;
            const card = document.getElementById('certDetailCard');

            // ìƒíƒœ íŒì •
            let status = 'valid';
            let statusText = 'ìœ íš¨';
            
            if (cert.validityType === 'periodic' && cert.expiryDate) {
                const today = new Date();
                const expiryDate = new Date(cert.expiryDate);
                const daysUntil = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                
                if (daysUntil < 0) {
                    status = 'expired';
                    statusText = 'ë§Œë£Œ';
                } else if (daysUntil <= 90) {
                    status = 'expiring';
                    statusText = 'ê°±ì‹  ì„ë°•';
                }
            }

            card.innerHTML = `
                <div class="card-title">ìê²©ì¦ ìƒì„¸ ì •ë³´</div>

                <div class="info-grid">
                    <div class="info-cell info-label">ìê²©ì¦ëª…</div>
                    <div class="info-cell info-value" style="grid-column: span 2;">${cert.certName}</div>
                    <div class="info-cell info-value" style="text-align: right;">
                        <span class="status-badge status-${status}">${statusText}</span>
                    </div>

                    <div class="info-cell info-label">ì†Œì§€ì</div>
                    <div class="info-cell info-value">${cert.holderName}</div>
                    <div class="info-cell info-label">ë°œê¸‰ê¸°ê´€</div>
                    <div class="info-cell info-value">${cert.issuer}</div>

                    <div class="info-cell info-label">ìê²©ì¦ë²ˆí˜¸</div>
                    <div class="info-cell info-value" style="grid-column: span 3;">${cert.certNumber}</div>

                    <div class="info-cell info-label">ì·¨ë“ì¼</div>
                    <div class="info-cell info-value">${formatDate(cert.acquiredDate)}</div>
                    <div class="info-cell info-label">ìœ íš¨ê¸°ê°„</div>
                    <div class="info-cell info-value">${cert.validityType === 'lifetime' ? 'í‰ìƒ' : formatDate(cert.expiryDate)}</div>

                    ${cert.validityType === 'periodic' && cert.expiryDate ? `
                        <div class="info-cell info-label">ë‚¨ì€ ê¸°ê°„</div>
                        <div class="info-cell info-value" style="grid-column: span 3; color: ${status === 'expiring' ? '#f59e0b' : status === 'expired' ? '#ef4444' : '#10b981'}; font-weight: 700;">
                            ${getDaysText(cert.expiryDate)}
                        </div>
                    ` : ''}

                    ${cert.continuingEducation && cert.continuingEducation.required ? `
                        <div class="info-cell info-label">ë³´ìˆ˜êµìœ¡</div>
                        <div class="info-cell info-value" style="grid-column: span 3;">
                            ${cert.continuingEducation.lastCompleted ? 'ë§ˆì§€ë§‰ ì´ìˆ˜: ' + formatDate(cert.continuingEducation.lastCompleted) : 'ì´ìˆ˜ ê¸°ë¡ ì—†ìŒ'}
                            ${cert.continuingEducation.nextDue ? ' / ë‹¤ìŒ ì´ìˆ˜: ' + formatDate(cert.continuingEducation.nextDue) : ''}
                        </div>
                    ` : ''}

                    ${cert.notes ? `
                        <div class="info-cell info-label">ë¹„ê³ </div>
                        <div class="info-cell info-value" style="grid-column: span 3;">${cert.notes}</div>
                    ` : ''}
                </div>

                ${cert.attachedFile ? `
                    <div style="text-align: center; margin: 20px 0;">
                        <button class="btn btn-primary" onclick="downloadFile()">
                            ğŸ“„ ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ (${cert.attachedFile.name})
                        </button>
                    </div>
                ` : ''}
            `;
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR');
        }

        function getDaysText(expiryDate) {
            const today = new Date();
            const expiry = new Date(expiryDate);
            const days = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
            
            if (days < 0) {
                return 'ë§Œë£Œë¨';
            } else if (days === 0) {
                return 'ì˜¤ëŠ˜ ë§Œë£Œ';
            } else {
                return `${days}ì¼ ë‚¨ìŒ`;
            }
        }

        function downloadFile() {
            if (!currentCert.attachedFile) return;
            
            const link = document.createElement('a');
            link.href = currentCert.attachedFile.data;
            link.download = currentCert.attachedFile.name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function editCertificate() {
            window.location.href = `hr-certificates.html?edit=${certId}`;
        }

        function goBack() {
            window.location.href = 'hr-certificates.html';
        }

        init();
    </script>
</body>
</html>
