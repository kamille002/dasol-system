<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìºì‹œ ì´ˆê¸°í™” - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        h1 {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 20px;
        }
        .icon {
            font-size: 80px;
            margin-bottom: 30px;
        }
        .status {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .log {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .log-item {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
        }
        .log-success {
            background: #d1fae5;
            color: #065f46;
        }
        .log-info {
            background: #dbeafe;
            color: #1e40af;
        }
        .log-warning {
            background: #fef3c7;
            color: #92400e;
        }
        .progress {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #10b981, #059669);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="icon" id="icon">ğŸ”„</div>
        <h1>ìºì‹œ ì´ˆê¸°í™”</h1>
        <div class="status" id="status">
            ëŒ€ì‹œë³´ë“œ ë²„íŠ¼ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šë‚˜ìš”?<br>
            ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìºì‹œë¥¼ ì™„ì „íˆ ì´ˆê¸°í™”í•˜ì„¸ìš”!
        </div>

        <div class="progress" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <button class="btn btn-danger" onclick="clearAllCache()">
            ğŸ—‘ï¸ ìºì‹œ ì™„ì „ ì‚­ì œ
        </button>
        <button class="btn btn-primary" onclick="goToDashboard()">
            ğŸ  ëŒ€ì‹œë³´ë“œë¡œ
        </button>

        <div class="log" id="log" style="display: none;"></div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            logDiv.style.display = 'block';
            
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logDiv.appendChild(logItem);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateProgress(percent) {
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressContainer');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = percent + '%';
        }

        async function clearAllCache() {
            try {
                document.getElementById('icon').textContent = 'â³';
                document.getElementById('status').innerHTML = 'ìºì‹œë¥¼ ì‚­ì œí•˜ëŠ” ì¤‘...<br>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!';
                
                addLog('ìºì‹œ ì‚­ì œ ì‹œì‘...', 'info');
                updateProgress(10);

                // 1. Service Worker ìºì‹œ ì‚­ì œ
                if ('caches' in window) {
                    addLog('Service Worker ìºì‹œ í™•ì¸ ì¤‘...', 'info');
                    const cacheNames = await caches.keys();
                    
                    addLog(`ë°œê²¬ëœ ìºì‹œ: ${cacheNames.length}ê°œ`, 'info');
                    updateProgress(30);

                    for (let cacheName of cacheNames) {
                        await caches.delete(cacheName);
                        addLog(`ì‚­ì œë¨: ${cacheName}`, 'success');
                    }
                    updateProgress(50);
                }

                // 2. Service Worker ë“±ë¡ í•´ì œ
                if ('serviceWorker' in navigator) {
                    addLog('Service Worker ë“±ë¡ í•´ì œ ì¤‘...', 'info');
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    
                    for (let registration of registrations) {
                        await registration.unregister();
                        addLog('Service Worker ë“±ë¡ í•´ì œ ì™„ë£Œ', 'success');
                    }
                    updateProgress(70);
                }

                // 3. localStorage í™•ì¸ (ì‚­ì œí•˜ì§€ ì•ŠìŒ - ë°ì´í„° ë³´ì¡´)
                addLog('localStorage ë°ì´í„° ë³´ì¡´ë¨ âœ…', 'info');
                updateProgress(80);

                // 4. ì™„ë£Œ
                updateProgress(100);
                addLog('ìºì‹œ ì‚­ì œ ì™„ë£Œ! âœ…', 'success');
                
                document.getElementById('icon').textContent = 'âœ…';
                document.getElementById('status').innerHTML = 
                    '<strong style="color: #10b981; font-size: 24px;">ìºì‹œ ì‚­ì œ ì™„ë£Œ!</strong><br><br>' +
                    'ì´ì œ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´<br>' +
                    'ìµœì‹  ë²„ì „ì´ ë¡œë“œë©ë‹ˆë‹¤!<br><br>' +
                    '<small style="color: #6b7280;">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•˜ì„¸ìš”.</small>';

                // 3ì´ˆ í›„ ìë™ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    addLog('í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì¤‘...', 'warning');
                    window.location.reload(true);
                }, 3000);

            } catch (error) {
                addLog(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'warning');
                console.error('ìºì‹œ ì‚­ì œ ì˜¤ë¥˜:', error);
                
                document.getElementById('icon').textContent = 'âš ï¸';
                document.getElementById('status').innerHTML = 
                    'ì¼ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì§€ë§Œ<br>' +
                    'ìºì‹œëŠ” ëŒ€ë¶€ë¶„ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>' +
                    '<strong>ìˆ˜ë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!</strong><br>' +
                    '<small>(Ctrl + Shift + R ë˜ëŠ” Cmd + Shift + R)</small>';
            }
        }

        function goToDashboard() {
            window.location.href = '/dashboard-tabs.html';
        }

        // ìë™ ì‹¤í–‰ ì˜µì…˜ (URL íŒŒë¼ë¯¸í„°ë¡œ ì œì–´)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('auto') === 'true') {
            setTimeout(() => {
                clearAllCache();
            }, 1000);
        }
    </script>
</body>
</html>
