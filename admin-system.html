<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œìŠ¤í…œ ê´€ë¦¬ - ë‹¤ì†”ë¬¼í™˜ê²½ì—°êµ¬ì†Œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 28px; }
        .header p { font-size: 14px; opacity: 0.9; margin-top: 5px; }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary { background: white; color: #ef4444; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .card h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #1f2937;
            border-bottom: 2px solid #ef4444;
            padding-bottom: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 14px;
            color: #6b7280;
        }
        .user-table {
            width: 100%;
            border-collapse: collapse;
        }
        .user-table th {
            background: #f9fafb;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e5e7eb;
        }
        .user-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        .user-table tr:hover {
            background: #f9fafb;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-admin {
            background: #fef3c7;
            color: #92400e;
        }
        .badge-user {
            background: #dbeafe;
            color: #1e40af;
        }
        .badge-active {
            background: #d1fae5;
            color: #065f46;
        }
        .badge-pending {
            background: #fee2e2;
            color: #991b1b;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .action-buttons button {
            padding: 6px 12px;
            font-size: 12px;
        }
        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #fef3c7;
            border-radius: 8px;
        }
        .search-box {
            margin-bottom: 20px;
        }
        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
        }
        .warning-banner {
            background: #fef2f2;
            border: 2px solid #fecaca;
            color: #991b1b;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>ğŸ” ì‹œìŠ¤í…œ ê´€ë¦¬</h1>
                <p>ê´€ë¦¬ì ì „ìš© - ì§ì› ê´€ë¦¬ ë° ì‹œìŠ¤í…œ ì„¤ì •</p>
            </div>
            <button class="btn btn-primary" onclick="window.location.href='dashboard-tabs.html'">â† ëŒ€ì‹œë³´ë“œ</button>
        </div>

        <div class="warning-banner">
            âš ï¸ ê´€ë¦¬ì ì „ìš© í˜ì´ì§€ì…ë‹ˆë‹¤. ëª¨ë“  ì‘ì—…ì€ ì‹ ì¤‘í•˜ê²Œ ì§„í–‰í•´ì£¼ì„¸ìš”.
        </div>

        <!-- í†µê³„ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ì „ì²´ ì§ì›</div>
                <div class="stat-number" id="totalUsers">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ê´€ë¦¬ì</div>
                <div class="stat-number" id="totalAdmins" style="color: #f59e0b;">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">í™œì„± ê³„ì •</div>
                <div class="stat-number" id="activeUsers" style="color: #10b981;">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
                <div class="stat-number" id="pendingUsers" style="color: #ef4444;">0</div>
            </div>
        </div>

        <!-- ëŒ€ëŸ‰ ì‘ì—… -->
        <div class="card">
            <h2>ğŸš¨ ìœ„í—˜í•œ ì‘ì—…</h2>
            <div class="bulk-actions">
                <button class="btn btn-warning" onclick="resetAllPasswords()">
                    ğŸ”„ ì „ì²´ ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
                </button>
                <button class="btn btn-danger" onclick="deleteInactiveUsers()">
                    ğŸ—‘ï¸ ë¹„í™œì„± ê³„ì • ì‚­ì œ
                </button>
            </div>
            <p style="color: #6b7280; font-size: 13px;">
                âš ï¸ ìœ„ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹¤í–‰ ì „ ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš”.
            </p>
        </div>

        <!-- ì§ì› ëª©ë¡ -->
        <div class="card">
            <h2>ğŸ‘¥ ì§ì› ê´€ë¦¬</h2>
            
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ğŸ” ì´ë¦„, ì´ë©”ì¼, ë¶€ì„œë¡œ ê²€ìƒ‰..." onkeyup="searchUsers()">
            </div>

            <table class="user-table">
                <thead>
                    <tr>
                        <th>ì´ë¦„</th>
                        <th>ì´ë©”ì¼</th>
                        <th>ë¶€ì„œ</th>
                        <th>ê¶Œí•œ</th>
                        <th>ìƒíƒœ</th>
                        <th>ê°€ì…ì¼</th>
                        <th>ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody id="userList"></tbody>
            </table>
        </div>
    </div>

    <script>
        let users = [];
        let currentUser = null;

        window.addEventListener('load', () => {
            checkAdminAccess();
            loadUsers();
            renderUsers();
            updateStats();
        });

        // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬
        function checkAdminAccess() {
            const loggedInUser = JSON.parse(localStorage.getItem('dasol_current_user') || 'null');
            
            if (!loggedInUser) {
                alert('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!');
                window.location.href = 'index.html';
                return;
            }

            currentUser = loggedInUser;

            // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬
            if (!currentUser.isAdmin) {
                alert('â›” ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤!\n\nê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.');
                window.location.href = 'dashboard-tabs.html';
                return;
            }
        }

        // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
        function loadUsers() {
            users = JSON.parse(localStorage.getItem('dasol_users') || '[]');
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalAdmins').textContent = users.filter(u => u.isAdmin).length;
            document.getElementById('activeUsers').textContent = users.filter(u => u.status === 'active' || u.status === 'approved').length;
            document.getElementById('pendingUsers').textContent = users.filter(u => u.status === 'pending').length;
        }

        // ì‚¬ìš©ì ëª©ë¡ ë Œë”ë§
        function renderUsers(filter = '') {
            const tbody = document.getElementById('userList');
            
            let filtered = users;
            if (filter) {
                filtered = users.filter(user => 
                    user.name.includes(filter) ||
                    user.email.includes(filter) ||
                    user.team.includes(filter)
                );
            }

            // ìµœì‹ ìˆœ ì •ë ¬
            filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            tbody.innerHTML = filtered.map(user => `
                <tr>
                    <td><strong>${user.name}</strong></td>
                    <td>${user.email}</td>
                    <td>${user.team}</td>
                    <td>
                        <span class="badge ${user.isAdmin ? 'badge-admin' : 'badge-user'}">
                            ${user.isAdmin ? 'ğŸ‘‘ ê´€ë¦¬ì' : 'ğŸ‘¤ ì¼ë°˜'}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${user.status === 'active' || user.status === 'approved' ? 'badge-active' : 'badge-pending'}">
                            ${user.status === 'active' ? 'í™œì„±' : user.status === 'approved' ? 'ìŠ¹ì¸ë¨' : 'ëŒ€ê¸°ì¤‘'}
                        </span>
                    </td>
                    <td>${new Date(user.createdAt).toLocaleDateString('ko-KR')}</td>
                    <td>
                        <div class="action-buttons">
                            ${user.isAdmin ? 
                                `<button class="btn btn-warning" onclick="removeAdmin('${user.id}')">ğŸ‘‘ í•´ì œ</button>` : 
                                `<button class="btn btn-success" onclick="makeAdmin('${user.id}')">ğŸ‘‘ ìŠ¹ê¸‰</button>`
                            }
                            <button class="btn btn-secondary" onclick="resetPassword('${user.id}')">ğŸ”„ PWì´ˆê¸°í™”</button>
                            ${currentUser.id !== user.id ? 
                                `<button class="btn btn-danger" onclick="deleteUser('${user.id}')">ğŸ—‘ï¸ ì‚­ì œ</button>` : 
                                `<button class="btn btn-secondary" disabled title="ë³¸ì¸ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤">ğŸ—‘ï¸ ì‚­ì œ</button>`
                            }
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ê²€ìƒ‰
        function searchUsers() {
            const filter = document.getElementById('searchInput').value;
            renderUsers(filter);
        }

        // ê´€ë¦¬ì ì§€ì •
        function makeAdmin(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            if (confirm(`${user.name}ë‹˜ì„ ê´€ë¦¬ìë¡œ ì§€ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ê´€ë¦¬ìëŠ” ëª¨ë“  ì‹œìŠ¤í…œ ê¸°ëŠ¥ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`)) {
                const index = users.findIndex(u => u.id === userId);
                users[index].isAdmin = true;
                
                localStorage.setItem('dasol_users', JSON.stringify(users));
                
                alert(`âœ… ${user.name}ë‹˜ì´ ê´€ë¦¬ìë¡œ ì§€ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                renderUsers();
                updateStats();
            }
        }

        // ê´€ë¦¬ì í•´ì œ
        function removeAdmin(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            // ë³¸ì¸ í•´ì œ ë¶ˆê°€
            if (userId === currentUser.id) {
                alert('âš ï¸ ë³¸ì¸ì˜ ê´€ë¦¬ì ê¶Œí•œì€ í•´ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            if (confirm(`${user.name}ë‹˜ì˜ ê´€ë¦¬ì ê¶Œí•œì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const index = users.findIndex(u => u.id === userId);
                users[index].isAdmin = false;
                
                localStorage.setItem('dasol_users', JSON.stringify(users));
                
                alert(`âœ… ${user.name}ë‹˜ì˜ ê´€ë¦¬ì ê¶Œí•œì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                renderUsers();
                updateStats();
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” (ê°œë³„)
        function resetPassword(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            const newPassword = prompt(`${user.name}ë‹˜ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:\n\n(ìµœì†Œ 8ì ì´ìƒ)`);
            
            if (!newPassword) return;
            
            if (newPassword.length < 8) {
                alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!');
                return;
            }

            if (confirm(`${user.name}ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìƒˆ ë¹„ë°€ë²ˆí˜¸: ${newPassword}`)) {
                const index = users.findIndex(u => u.id === userId);
                users[index].password = newPassword;
                
                localStorage.setItem('dasol_users', JSON.stringify(users));
                
                alert(`âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n${user.name}ë‹˜ì—ê²Œ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì „ë‹¬í•´ì£¼ì„¸ìš”:\n${newPassword}`);
            }
        }

        // ì „ì²´ ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”
        function resetAllPasswords() {
            if (!confirm('âš ï¸ ì •ë§ë¡œ ì „ì²´ ì§ì›ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                return;
            }

            const confirmText = prompt('ê³„ì†í•˜ë ¤ë©´ "ì „ì²´ì´ˆê¸°í™”"ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (confirmText !== 'ì „ì²´ì´ˆê¸°í™”') {
                alert('âŒ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }

            const defaultPassword = 'dasol1234';
            
            users.forEach(user => {
                if (user.id !== currentUser.id) { // ë³¸ì¸ ì œì™¸
                    user.password = defaultPassword;
                }
            });

            localStorage.setItem('dasol_users', JSON.stringify(users));

            alert(`âœ… ì „ì²´ ë¹„ë°€ë²ˆí˜¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: ${defaultPassword}\n\nê° ì§ì›ì—ê²Œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì„ ì•ˆë‚´í•´ì£¼ì„¸ìš”.`);
        }

        // ì§ì› ì‚­ì œ
        function deleteUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            // ë³¸ì¸ ì‚­ì œ ë¶ˆê°€
            if (userId === currentUser.id) {
                alert('âš ï¸ ë³¸ì¸ ê³„ì •ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            if (confirm(`âš ï¸ ì •ë§ë¡œ ${user.name}ë‹˜ì˜ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`)) {
                const confirmDelete = prompt(`ê³„ì†í•˜ë ¤ë©´ "${user.name}"ì„ ì…ë ¥í•˜ì„¸ìš”:`);
                
                if (confirmDelete !== user.name) {
                    alert('âŒ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    return;
                }

                users = users.filter(u => u.id !== userId);
                localStorage.setItem('dasol_users', JSON.stringify(users));

                alert(`âœ… ${user.name}ë‹˜ì˜ ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                renderUsers();
                updateStats();
            }
        }

        // ë¹„í™œì„± ê³„ì • ì‚­ì œ
        function deleteInactiveUsers() {
            const inactiveUsers = users.filter(u => u.status === 'pending');
            
            if (inactiveUsers.length === 0) {
                alert('âœ… ì‚­ì œí•  ë¹„í™œì„± ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (!confirm(`âš ï¸ ${inactiveUsers.length}ê°œì˜ ëŒ€ê¸°ì¤‘ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`)) {
                return;
            }

            const confirmText = prompt('ê³„ì†í•˜ë ¤ë©´ "ë¹„í™œì„±ì‚­ì œ"ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (confirmText !== 'ë¹„í™œì„±ì‚­ì œ') {
                alert('âŒ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }

            users = users.filter(u => u.status !== 'pending');
            localStorage.setItem('dasol_users', JSON.stringify(users));

            alert(`âœ… ${inactiveUsers.length}ê°œì˜ ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            renderUsers();
            updateStats();
        }
    </script>
</body>
</html>
